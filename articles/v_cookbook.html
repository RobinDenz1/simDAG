<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>simDAG Cookbook • simDAG</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="simDAG Cookbook">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v_cookbook.html">simDAG Cookbook</a></li>
    <li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>simDAG Cookbook</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/siMDAG/blob/main/vignettes/v_cookbook.Rmd" class="external-link"><code>vignettes/v_cookbook.Rmd</code></a></small>
      <div class="d-none name"><code>v_cookbook.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>simDAG</code> package can be used to generate all kinds of
data, as shown in the many examples and other vignettes of this package.
In this vignette we will further illustrate the capabilities of the
package, by giving very short and simplified examples on how to use
<code>simDAG</code> to generate multiple different kinds of data. The
vignette can be seen as a sort of “cookbook”, in the sense that it
includes the building blocks for many different possible data generation
processes (DGP), which users can expand on for their specific needs.
Note that the examples shown are not meant to be realistic, they are
only meant to show the general structure of the required code.</p>
<p>This vignette assumes that the reader is already somewhat familiar
with the <code>simDAG</code> syntax. More detailed explanations of how
to simulate data using a time-fixed DAG and DAGs including
time-dependent variables is given in other vignettes and the
documentation of the functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="randomized-controlled-trials">Randomized Controlled Trials<a class="anchor" aria-label="anchor" href="#randomized-controlled-trials"></a>
</h2>
<p>First, we will give some examples on how data for randomized
controlled trials (RCT) could be generated. In a classic RCT, the
treatment of interest (below named <code>Treatment</code>) is randomly
assigned to the individuals of the study, making it a “root node” in the
terminology of DAGs.</p>
<div class="section level3">
<h3 id="two-treatment-groups">Two Treatment Groups<a class="anchor" aria-label="anchor" href="#two-treatment-groups"></a>
</h3>
<p>Below is an example for an RCT with two treatment groups, a binary
outcome and two baseline covariates (<code>Age</code> and
<code>Sex</code>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">55</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Treatment"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Outcome"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">12</span> <span class="op">+</span> <span class="va">Age</span><span class="op">*</span><span class="fl">0.2</span> <span class="op">+</span> <span class="va">Sex</span><span class="op">*</span><span class="fl">1.1</span> <span class="op">+</span> <span class="va">Treatment</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Age    Sex Treatment Outcome</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;lgcl&gt;    &lt;lgcl&gt;  &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 47.99978  FALSE     FALSE   FALSE</span></span>
<span><span class="co">#&gt; 2: 56.27659   TRUE      TRUE   FALSE</span></span>
<span><span class="co">#&gt; 3: 42.81368  FALSE     FALSE   FALSE</span></span>
<span><span class="co">#&gt; 4: 54.97214  FALSE      TRUE   FALSE</span></span>
<span><span class="co">#&gt; 5: 58.10776   TRUE     FALSE   FALSE</span></span>
<span><span class="co">#&gt; 6: 60.74206  FALSE      TRUE   FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="three-or-more-treatment-groups">Three or More Treatment Groups<a class="anchor" aria-label="anchor" href="#three-or-more-treatment-groups"></a>
</h3>
<p>The example from earlier can easily be made a little more complex, by
including three treatment groups instead of just two. This can be
achieved by using the <code><a href="../reference/rcategorical.html">rcategorical()</a></code> function as node type
instead of the <code><a href="../reference/rbernoulli.html">rbernoulli()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">55</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Treatment"</span>, type<span class="op">=</span><span class="st">"rcategorical"</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33333</span>, <span class="fl">0.33333</span>, <span class="fl">0.33333</span><span class="op">)</span>,</span>
<span>       labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"Med1"</span>, <span class="st">"Med2"</span><span class="op">)</span>, output<span class="op">=</span><span class="st">"factor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Outcome"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">12</span> <span class="op">+</span> <span class="va">Age</span><span class="op">*</span><span class="fl">0.2</span> <span class="op">+</span> <span class="va">Sex</span><span class="op">*</span><span class="fl">1.1</span> <span class="op">+</span> <span class="va">TreatmentMed1</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> </span>
<span>         <span class="va">TreatmentMed2</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Age   Sex Treatment Outcome</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;    &lt;fctr&gt;  &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 56.92997     0   Placebo    TRUE</span></span>
<span><span class="co">#&gt; 2: 50.80579     1      Med2   FALSE</span></span>
<span><span class="co">#&gt; 3: 52.34986     1      Med1   FALSE</span></span>
<span><span class="co">#&gt; 4: 43.53409     1      Med2   FALSE</span></span>
<span><span class="co">#&gt; 5: 64.27632     1      Med1   FALSE</span></span>
<span><span class="co">#&gt; 6: 51.87643     1      Med2   FALSE</span></span></code></pre></div>
<p>By setting <code>probs=c(0.33333, 0.33333, 0.33333)</code>, each
treatment group is choosen with a probability of 0.33333, meaning that
the resulting groups should be roughly of equal size in expectation.</p>
</div>
<div class="section level3">
<h3 id="multiple-outcome-measurements">Multiple Outcome Measurements<a class="anchor" aria-label="anchor" href="#multiple-outcome-measurements"></a>
</h3>
<p>The previous two examples assumed that there was a single fixed time
at which the binary outcome was measured. Below we switch things up a
bit by using a continuous outcome that is measured at 5 different points
in time after baseline. The syntax is nearly the same as before, with
the major difference being that we now use a <code><a href="../reference/node.html">node_td()</a></code> call
to define the outcome, because it is time-dependent. Additionally,
because of this inclusion of a time-dependent node, we have to use the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function instead of the
<code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function. Finally, the
<code><a href="../reference/sim2data.html">sim2data()</a></code> has to be called to obtain the desired output in
the long-format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">55</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Treatment"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"Outcome"</span>, type<span class="op">=</span><span class="st">"gaussian"</span>,</span>
<span>          formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">12</span> <span class="op">+</span> <span class="va">Age</span><span class="op">*</span><span class="fl">0.2</span> <span class="op">+</span> <span class="va">Sex</span><span class="op">*</span><span class="fl">1.1</span> <span class="op">+</span> <span class="va">Treatment</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span>, error<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span>, max_t<span class="op">=</span><span class="fl">5</span>, save_states<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time      Age   Sex Treatment    Outcome</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;    &lt;num&gt; &lt;num&gt;    &lt;lgcl&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1 47.29087     1     FALSE -0.6673257</span></span>
<span><span class="co">#&gt; 2:     1     2 47.29087     1     FALSE -2.6859386</span></span>
<span><span class="co">#&gt; 3:     1     3 47.29087     1     FALSE -2.3041754</span></span>
<span><span class="co">#&gt; 4:     1     4 47.29087     1     FALSE -1.4885914</span></span>
<span><span class="co">#&gt; 5:     1     5 47.29087     1     FALSE -1.9022557</span></span>
<span><span class="co">#&gt; 6:     2     1 58.86501     0      TRUE -3.7253747</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="non-compliance-to-treatment-assignment">Non-Compliance to Treatment Assignment<a class="anchor" aria-label="anchor" href="#non-compliance-to-treatment-assignment"></a>
</h3>
<p>Previously we assumed that the treatment was assigned at baseline and
never changed throughout the study. In real RCTs, individuals are often
assigned to <em>treatment strategies</em> instead (for example: one pill
per week). Some individuals might not adhere to their assigned treatment
strategy, by for example “switching back” to not taking the pill.</p>
<p>The following code shows one possible way to simulate such data. In
the shown DGP, individuals are assigned to a treatment strategy at
baseline. Here, <code>Treatment = FALSE</code> refers to the control
condition in which the individual should not take any pills. In the
intervention group (<code>Treatment = TRUE</code>), however, the
individual is assigned to take a pill every week. On average, 5% of
these individuals stop taking their pills with each passing week. Once
they stop, they never start taking them again. The continuous outcome at
each observation time depends on how many pills each individual took in
total. None of the individuals in the control group start taking pills.
For simplicity, the simulation is run without any further covariates for
5 weeks.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to calculate the probability of taking the pill at t,</span></span>
<span><span class="co"># given the current treatment status of the person</span></span>
<span><span class="va">prob_treat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">Treatment_event</span>, <span class="fl">0</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Treatment_event"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"Treatment"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Treatment_event"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_treat</span>, event_count<span class="op">=</span><span class="cn">TRUE</span>, event_duration<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"Outcome"</span>, type<span class="op">=</span><span class="st">"gaussian"</span>, formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">2</span> <span class="op">+</span> <span class="va">Treatment_event_count</span><span class="op">*</span><span class="op">-</span><span class="fl">0.3</span>,</span>
<span>          error<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span>, max_t<span class="op">=</span><span class="fl">5</span>, save_states<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time Treatment   Outcome Treatment_event_count</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;    &lt;lgcl&gt;     &lt;num&gt;                 &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1      TRUE -2.988481                     1</span></span>
<span><span class="co">#&gt; 2:     1     2      TRUE -2.545962                     2</span></span>
<span><span class="co">#&gt; 3:     1     3      TRUE -3.029647                     3</span></span>
<span><span class="co">#&gt; 4:     1     4      TRUE -2.593921                     4</span></span>
<span><span class="co">#&gt; 5:     1     5      TRUE  2.327432                     5</span></span>
<span><span class="co">#&gt; 6:     2     1      TRUE -3.427912                     1</span></span></code></pre></div>
<p>What this DAG essentially means is that first, the
<code>Treatment_event</code> column is generated, which includes the
assigned treatment at baseline. We called it
<code>Treatment_event</code> here instead of just
<code>Treatment</code>, because the value in this column should be
updated with each iteration and nodes of type
<code>"time_to_event"</code> always split the node into two columns:
status and time. By setting <code>event_count=TRUE</code> in the
<code><a href="../reference/node.html">node_td()</a></code> call for the <code>Treatment</code> node, a count
of the amount of pills taken up to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is directly calculated at each point in time (column
<code>Treatment_event_count</code>), which can then be used directly to
generate the <code>Outcome</code> node.</p>
<p>This simulation could be made more realistic (or just more complex),
by for example adding either of the following things:</p>
<ul>
<li>making the probability of switching dependent on the outcome at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t - 1</annotation></semantics></math>
</li>
<li>making the probability of switching dependent on other
variables</li>
<li>allowing patients to switch back to taking the pill after
discontinuation</li>
<li>allowing patients in the control group to switch to the
treatment</li>
</ul>
<p>These additions are left as an exercise to the user.</p>
</div>
<div class="section level3">
<h3 id="with-cluster-randomization">With Cluster Randomization<a class="anchor" aria-label="anchor" href="#with-cluster-randomization"></a>
</h3>
<p>Instead of randomly assigning <em>individuals</em> to the treatment,
many trials actually randomly assign the treatment at the level of
clinics or other forms of <em>clusters</em>, which is fittingly called
cluster randomization. This may be implemented in <code>simDAG</code>
using the following syntax:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Clinic"</span>, type<span class="op">=</span><span class="st">"rcategorical"</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Treatment"</span>, type<span class="op">=</span><span class="st">"identity"</span>, formula<span class="op">=</span> <span class="op">~</span> <span class="va">Clinic</span> <span class="op">&gt;=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Outcome"</span>, type<span class="op">=</span><span class="st">"poisson"</span>, formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">5</span> <span class="op">+</span> <span class="va">Treatment</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span> <span class="co"># TODO: needs random effect</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Clinic Treatment Outcome</span></span>
<span><span class="co">#&gt;     &lt;int&gt;    &lt;lgcl&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      5     FALSE       0</span></span>
<span><span class="co">#&gt; 2:      9     FALSE       0</span></span>
<span><span class="co">#&gt; 3:     19     FALSE       0</span></span>
<span><span class="co">#&gt; 4:     17     FALSE       0</span></span>
<span><span class="co">#&gt; 5:     11     FALSE       0</span></span>
<span><span class="co">#&gt; 6:      3     FALSE       0</span></span></code></pre></div>
<p>In this DGP, each individual is randomly assigned to one of 50
Clinics with equal probability. All patients in clinics numbered 0-24
are assigned to the control group, while the other patients are assigned
to the treatment group. The outcome is then generated using a Poisson
regression with a random intercept based on the clinic.</p>
</div>
</div>
<div class="section level2">
<h2 id="observational-studies">Observational Studies<a class="anchor" aria-label="anchor" href="#observational-studies"></a>
</h2>
<p>In all previous examples, the variable of interest was a treatment
that was randomly assigned and did not depend on other variables
(excluding the <code>Clinic</code> for the cluster randomization
example). In observational studies, the variable of interest is usually
not randomly assigned. Below are some examples for generating such
observational study data.</p>
<div class="section level3">
<h3 id="crossectional-data">Crossectional Data<a class="anchor" aria-label="anchor" href="#crossectional-data"></a>
</h3>
</div>
<div class="section level3">
<h3 id="panel-data">Panel Data<a class="anchor" aria-label="anchor" href="#panel-data"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="miscellaneous">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"></a>
</h2>
<div class="section level3">
<h3 id="including-outliers">Including “Outliers”<a class="anchor" aria-label="anchor" href="#including-outliers"></a>
</h3>
</div>
<div class="section level3">
<h3 id="including-missing-values">Including Missing Values<a class="anchor" aria-label="anchor" href="#including-missing-values"></a>
</h3>
<p>Real data usually includes at least some missing values in key
variables. Below is a very simple example on how users could include
missing values in their data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_real"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_missing"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_observed"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">A_missing</span>, <span class="cn">NA</span>, <span class="va">A_real</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;       A_real A_missing A_observed</span></span>
<span><span class="co">#&gt;        &lt;num&gt;    &lt;lgcl&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  8.614947     FALSE   8.614947</span></span>
<span><span class="co">#&gt; 2: 12.102518     FALSE  12.102518</span></span>
<span><span class="co">#&gt; 3:  9.792132     FALSE   9.792132</span></span>
<span><span class="co">#&gt; 4: 11.092641      TRUE         NA</span></span>
<span><span class="co">#&gt; 5: 16.440288     FALSE  16.440288</span></span>
<span><span class="co">#&gt; 6: 12.146488     FALSE  12.146488</span></span></code></pre></div>
<p>In this DAG, the real values of node <code>A</code> are generated
first. Afterwards, an indicator of whether the corresponding values is
observed is drawn randomly for each individual in node
<code>A_missing</code>. The actually observed value, denoted
<code>A_observed</code>, is then generated by simply using either the
value of <code>A_real</code> or a simple <code>NA</code> if
<code>A_missing==TRUE</code>. The missingness shown here would
correspond to <strong>missing completely at random</strong> (MCAR) in
the categorisation by XX. Although this might seem a little cumbersome
at first, it does allow quite a lot of flexibility in the specification
of different missingness mechanisms. For example, to simulate
<strong>missing at random</strong> (MAR) patterns, we could use the
following code instead:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_real"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"B_real"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_missing"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"B_missing"</span>, type<span class="op">=</span><span class="st">"binomial"</span>, formula<span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">5</span> <span class="op">+</span> <span class="va">A_real</span><span class="op">*</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A_observed"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">A_missing</span>, <span class="cn">NA</span>, <span class="va">A_real</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"B_observed"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">B_missing</span>, <span class="cn">NA</span>, <span class="va">B_real</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;        A_real B_real A_missing B_missing A_observed B_observed</span></span>
<span><span class="co">#&gt;         &lt;num&gt; &lt;lgcl&gt;    &lt;lgcl&gt;    &lt;lgcl&gt;      &lt;num&gt;     &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: -0.2844169   TRUE     FALSE     FALSE -0.2844169       TRUE</span></span>
<span><span class="co">#&gt; 2: -0.9272721   TRUE      TRUE     FALSE         NA       TRUE</span></span>
<span><span class="co">#&gt; 3: -1.1370159  FALSE     FALSE     FALSE -1.1370159      FALSE</span></span>
<span><span class="co">#&gt; 4:  1.5727315  FALSE     FALSE     FALSE  1.5727315      FALSE</span></span>
<span><span class="co">#&gt; 5: -0.5678503  FALSE     FALSE     FALSE -0.5678503      FALSE</span></span>
<span><span class="co">#&gt; 6: -0.9173047   TRUE     FALSE     FALSE -0.9173047       TRUE</span></span></code></pre></div>
<p>Here, the missingness in <code>A_observed</code> is again MCAR,
because it is independent of everything. The missingness in
<code>B_observed</code>, however, is MAR because the probability of
missingness is dependent on the actually observed value of
<code>A_real</code>.</p>
</div>
<div class="section level3">
<h3 id="including-measurement-error">Including Measurement Error<a class="anchor" aria-label="anchor" href="#including-measurement-error"></a>
</h3>
<p>Measurement error refers to situations in which variables of interest
are not measured perfectly. For example, the disease of interest may
only be detected in 90% of all patients with the disease and may falsely
be detected in 1% of all patients without the disease. The same strategy
shown for missing values could be used to simulate such data using
<code>simDAG</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`TRUE`<span class="op">=</span><span class="fl">0.9</span>, `FALSE`<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Disease_real"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Disease_observed"</span>, type<span class="op">=</span><span class="st">"conditional_prob"</span>, parents<span class="op">=</span><span class="st">"Disease_real"</span>,</span>
<span>       probs<span class="op">=</span><span class="va">probs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Disease_real Disease_observed</span></span>
<span><span class="co">#&gt;          &lt;lgcl&gt;           &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:         TRUE             TRUE</span></span>
<span><span class="co">#&gt; 2:        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 3:        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 4:         TRUE             TRUE</span></span>
<span><span class="co">#&gt; 5:         TRUE            FALSE</span></span>
<span><span class="co">#&gt; 6:         TRUE             TRUE</span></span></code></pre></div>
<p>In this example, the disease is present in 50% of all individuals. By
using a node with <code>type="conditional_prob"</code> we can easily
draw new values for the observed disease status by specifying the
<code>probs</code> argument correctly. We could similarly extend this
example to make the probability of misclassification dependent on
another variable:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first TRUE / FALSE refers to Sex = TRUE / FALSE</span></span>
<span><span class="co"># second TRUE / FALSE refers to Disease = TRUE / FALSE</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>TRUE.TRUE<span class="op">=</span><span class="fl">0.9</span>, TRUE.FALSE<span class="op">=</span><span class="fl">0.01</span>,</span>
<span>              FALSE.TRUE<span class="op">=</span><span class="fl">0.8</span>, FALSE.FALSE<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Disease_real"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"Disease_observed"</span>, type<span class="op">=</span><span class="st">"conditional_prob"</span>,</span>
<span>       parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sex"</span>, <span class="st">"Disease_real"</span><span class="op">)</span>, probs<span class="op">=</span><span class="va">probs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Sex Disease_real Disease_observed</span></span>
<span><span class="co">#&gt;    &lt;lgcl&gt;       &lt;lgcl&gt;           &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:   TRUE        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 2:   TRUE        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 3:  FALSE         TRUE             TRUE</span></span>
<span><span class="co">#&gt; 4:  FALSE        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 5:  FALSE        FALSE            FALSE</span></span>
<span><span class="co">#&gt; 6:  FALSE        FALSE            FALSE</span></span></code></pre></div>
<p>In this extended example, <code>Sex</code> is equally distributed
among the population (with <code>TRUE</code> = “female” and
<code>FALSE</code> = “male”). In this example, the probability of being
diagnosed with the disease (<code>Disease_observed</code>) if the
disease is actually present is 0.9 for females and only 0.8 for males.
Similarly, the probability of being diagnosed if the disease is not
present is 0.01 for females and 0.05 for males.</p>
</div>
<div class="section level3">
<h3 id="very-heterogeneous-data">Very Heterogeneous Data<a class="anchor" aria-label="anchor" href="#very-heterogeneous-data"></a>
</h3>
</div>
<div class="section level3">
<h3 id="ensuring-event-order-in-discrete-time-simulations">Ensuring Event-Order in Discrete-Time Simulations<a class="anchor" aria-label="anchor" href="#ensuring-event-order-in-discrete-time-simulations"></a>
</h3>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
