<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulating Data from a DAG with Network Dependencies • simDAG</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating Data from a DAG with Network Dependencies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/simDAG.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_custom_nodes.html">Specifying Custom Node Types in a DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_networks.html">Simulating Data from a DAG with Network Dependencies</a></li>
    <li><a class="dropdown-item" href="../articles/v_cookbook.html">simDAG Cookbook</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulating Data from a DAG with Network Dependencies</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/siMDAG/blob/v0.4.0/vignettes/v_sim_networks.Rmd" class="external-link"><code>vignettes/v_sim_networks.Rmd</code></a></small>
      <div class="d-none name"><code>v_sim_networks.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Most algorithms used to generate artificial data based on DAGs do so
using the classic assumption that all individual observations are
independently and identically distributed (the classic i.i.d.
assumption). This is done for multiple reasons. First, it makes the
specification of the data generation process (DGP) a lot easier:
distributions and structural equations can be defined once for the
entire DGP and used to generate arbitrarily large amounts of data.
Secondly, artificial DAG based data is most often used in simulation
studies or other contexts in which statistical models are applied to
them. Since most of these models require the i.i.d. assumption, it makes
sense to generate data this way.</p>
<p>This is, however, not the case for all applications. For example, the
spread of an infectious disease is dependent on how “connected” the
population at risk is <span class="citation">(Danon et al. 2011)</span>.
An individual with many contacts will usually have a higher probability
of coming into contact with an infected person and thus will have a
higher chance of getting infected as well. This fact is in direct
opposition to the i.i.d. assumption, because the infection status of one
individual influences the infection status of other individuals. The
individuals are said to “interfere” with each other <span class="citation">(VanderWeele and An 2013)</span>. Networks-based
simulations are one way to model such dependencies.</p>
<p>The following vignette introduces this methodology and how it is
implemented in the <code>simDAG</code> R package <span class="citation">(Denz and Timmesfeld 2025)</span>. This is an advanced
topic. We assume that the reader is already familiar with the general
<code>simDAG</code> syntax and DAG based simulations. Please consult the
associated paper or the numerous other vignettes first, if this is not
the case.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-are-networks-based-simulations">What are networks-based simulations?<a class="anchor" aria-label="anchor" href="#what-are-networks-based-simulations"></a>
</h2>
<p>In a networks-based simulation, each individual is embedded in one or
multiple networks. These networks may have an arbitrary amount of
connections between the individuals, signifying who is connected to who.
Data may then be simulated using the essentially the same approach that
is used in classic DAG-based simulations, with the added possibility of
using the network structures to define individual dependencies. For
example, a variable could then be defined not only as a function of
other variables, but also as a function of the neighbors of an
individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(and their variable values), where neighbors are defined as any
individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
that share some connection with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in a given network (although in directed networks, multiple options to
define neighbors are possible). A more rigorous explanation, along with
an explanation of their implementation of the methodology in the
<code>simcausal</code> package, is given by <span class="citation">Sofrygin, Neugebauer, and van der Laan
(2017)</span>.</p>
<p>In network science, the points in a networks are often called
<em>nodes</em> or <em>vertices</em>, while the connections between them
are usually called <em>edges</em> or, in directed networks,
<em>arrows</em>. When talking about networks I will stick to the terms
<em>vertices</em> and <em>edges</em> here, to avoid confusion with the
terms <em>nodes</em> and <em>arrows</em> that are also used when talking
about DAGs. Note that a DAG is of course also a special type of network,
but it serves a different purpose here. In the simulations described
here, the DAG defines the causal relationships between variables, while
the network describes connections between individuals.</p>
</div>
<div class="section level2">
<h2 id="networks-in-regular-simulations">Networks in regular simulations<a class="anchor" aria-label="anchor" href="#networks-in-regular-simulations"></a>
</h2>
<div class="section level3">
<h3 id="a-single-network">A single network<a class="anchor" aria-label="anchor" href="#a-single-network"></a>
</h3>
<p>We will start with a simple example, using only a single un-directed,
un-weighted, static network that never changes and only a few variables
that are also constant over time.</p>
<p>Consider the following simple network:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                   to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">graph_from_data_frame</a></span><span class="op">(</span><span class="va">data</span>, directed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this network, individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
has three neighbors:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>,</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2, 3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>,
while individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>5</mn><annotation encoding="application/x-tex">5</annotation></semantics></math>
only has two neighbors:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>3</mn><annotation encoding="application/x-tex">3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>.
We will first simulate <code>age</code> and <code>sex</code> values for
all of these individuals, irrespective of their position in the network,
using the standard <code>simDAG</code> syntax to generate data from a
<code>DAG</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span></span></code></pre></div>
<p>Here, <code>age</code> and <code>sex</code> are both root nodes, with
<code>age</code> being a normally distributed variable with mean 50 and
standard deviation of 10 and <code>sex</code> being Bernoulli
distributed with equal probabilities of being either male
(<code>sex = 0</code>) or female (<code>sex = 1</code>). Now every
person has assigned values. If we generated the data right now, without
further nodes, it would look like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5245</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span>, row.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 35.08209     1</span></span>
<span><span class="co">#&gt; 2: 47.01248     1</span></span>
<span><span class="co">#&gt; 3: 35.42111     0</span></span>
<span><span class="co">#&gt; 4: 57.29242     0</span></span>
<span><span class="co">#&gt; 5: 43.33519     0</span></span></code></pre></div>
<p>The rownames of this <code>data.table</code> show to which person
each value belongs. In other words, row 1 will be mapped to vertex 1 in
the network, row 2 will be mapped to vertex 2 of the network and so on.
To impose the network structure onto this <code>DAG</code>, we can
simply add the already generated <code>igraph</code> object to it using
the <code><a href="../reference/network.html">network()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span> <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"network1"</span>, net<span class="op">=</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p>In this <code><a href="../reference/network.html">network()</a></code> call, all we had to do was provide a
<code>name</code> for the network (here called <code>network1</code>)
and the network itself, for which we used the <code>igraph</code>
object. Note that, because the graph is pre-generated with only 5
individuals in it, this DAG can now only generate data for 5 individuals
as well when actually using this network. To allow flexible changes of
<code>n_sim</code> when calling <code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> or
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> later on, users need to supply a
function instead, which we will show later. For now we stay with the 5
individuals.</p>
<p>Now that the network is added, we are able to use <code><a href="../reference/net.html">net()</a></code>
syntax in the <code>formula</code> argument of any further nodes. For
example, we could define a new variable called <code>infected</code>,
which should contain an indicator of whether someone is infected with
some infectious disease or not, as a function of the persons own
<code>age</code> and <code>sex</code> <em>and</em> as a function of
their neighbors <code>age</code> and <code>sex</code> using the
following syntax:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>                  formula<span class="op">=</span> <span class="op">~</span> <span class="fl">5</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                    <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p>In this node, the infection probability increase with the persons own
<code>age</code>, is higher for males, decreases with higher mean ages
of the persons neighbors and decreases with higher proportions of
females among a persons neighbors. If we run the simulation again with
this updated DGP, the results looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5245</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span>, row.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 35.08209     1    FALSE</span></span>
<span><span class="co">#&gt; 2: 47.01248     1    FALSE</span></span>
<span><span class="co">#&gt; 3: 35.42111     0    FALSE</span></span>
<span><span class="co">#&gt; 4: 57.29242     0     TRUE</span></span>
<span><span class="co">#&gt; 5: 43.33519     0     TRUE</span></span></code></pre></div>
<p>Note that the intermediate variables (mean age of neighbors,
proportion of female neighbors) are not included in this output. Users
may use nodes of type <code>"identity"</code> to actually save and
inspect the output of <code><a href="../reference/net.html">net()</a></code> calls instead. For example,
calculating the number of infected neighbors per person could now be
done using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"n_inf_neighbors"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>                  formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infected</span><span class="op">)</span><span class="op">)</span>, kind<span class="op">=</span><span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5245</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span>, row.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected n_inf_neighbors</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 35.08209     1    FALSE               1</span></span>
<span><span class="co">#&gt; 2: 47.01248     1    FALSE               1</span></span>
<span><span class="co">#&gt; 3: 35.42111     0    FALSE               2</span></span>
<span><span class="co">#&gt; 4: 57.29242     0     TRUE               1</span></span>
<span><span class="co">#&gt; 5: 43.33519     0     TRUE               1</span></span></code></pre></div>
<p>This may be useful to inspect if the aggregation worked or to save
some computation time when the same <code><a href="../reference/net.html">net()</a></code> call is used in
multiple subsequent nodes. In this example, individuals 4 and 5 are
infected, which means that individuals 1, 2 and 4 and 5 each have one
infected neighbor, while individual 3 has 2 infected neighbors because
it has a connection to both individuals 4 and 5.</p>
</div>
<div class="section level3">
<h3 id="multiple-networks">Multiple networks<a class="anchor" aria-label="anchor" href="#multiple-networks"></a>
</h3>
<p>In reality, individuals are usually embedded in more than one network
at the same time. People are part of friendship networks, contact
networks, professional networks and so on. This is also directly
supported by the <code>simDAG</code> package. All we have to do is add
multiple networks to the <code>DAG</code>. Below we first generate two
random networks of the same size (20 individuals) using the
<code>igraph</code> package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">56356</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, m<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, m<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g1</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"salmon"</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"lightblue"</span></span></code></pre></div>
<p>Suppose that the first network is a “friendship network”, showing who
is friends with who and the second is a “professional network”, showing
who works with who. They look like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g1</span>, main<span class="op">=</span><span class="st">"Friends"</span>, margin<span class="op">=</span><span class="fl">0</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g2</span>, main<span class="op">=</span><span class="st">"Work"</span>, margin<span class="op">=</span><span class="fl">0</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We colored the vertices differently to highlight that they are two
distinct networks. We now first repeat large parts of the
<code>DAG</code> from earlier, but add both networks to it this
time:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"friends"</span>, net<span class="op">=</span><span class="va">g1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"work"</span>, net<span class="op">=</span><span class="va">g2</span><span class="op">)</span></span></code></pre></div>
<p>We can now add a new node to this <code>DAG</code>, that utilizes
both network dependencies at the same time:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>                  formula<span class="op">=</span> <span class="op">~</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                    <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, net<span class="op">=</span><span class="st">"friends"</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> </span>
<span>                    <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, net<span class="op">=</span><span class="st">"work"</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p>This is exactly the same node definition of the previous example,
with the only difference being that the mean <code>age</code> of the
<code>friends</code> network is used and the proportion of females is
used only for the <code>work</code> network. The results look like
this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span>, row.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 53.86490     0    FALSE</span></span>
<span><span class="co">#&gt; 2: 46.69516     0    FALSE</span></span>
<span><span class="co">#&gt; 3: 33.77426     0     TRUE</span></span>
<span><span class="co">#&gt; 4: 49.78544     1       NA</span></span>
<span><span class="co">#&gt; 5: 58.56361     0    FALSE</span></span>
<span><span class="co">#&gt; 6: 66.37300     0    FALSE</span></span></code></pre></div>
<p>Interestingly, individual 4 has a value of <code>NA</code> in the
<code>infected</code> node. The reason for this is that individual 4
does not have any friends (don’t worry, she is not real so she can’t be
sad about this) and thus the <code>mean(age)</code> call is not defined
for this person. To replace such <code>NA</code> values with some other
values, the <code>na</code> argument of <code><a href="../reference/net.html">net()</a></code> may be
used.</p>
</div>
<div class="section level3">
<h3 id="weighted-networks">Weighted networks<a class="anchor" aria-label="anchor" href="#weighted-networks"></a>
</h3>
<p>In many applications in network science, the edges of networks are
said to have <em>weights</em>, to specify that some connections are
stronger than others. In the friendship network from earlier, the
weights could for example indicate that one friendship is closer than
another one. Using such weights is also directly supported for
simulation purposes in this package. Let us first add some random
weights to the friendships from the network shown above. Re-plotting
this network one can see that the edges now have different weights:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g1</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g1</span><span class="op">)</span><span class="op">)</span>, min<span class="op">=</span><span class="fl">1</span>, max<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g1</span>, edge.width<span class="op">=</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g1</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Regular <code><a href="../reference/net.html">net()</a></code> calls will ignore these weights, if not
specifically told not to. Users should use the internal
<code>..weight..</code> variable to use the weights. For example, if we
want to re-use the DAG definition from earlier, we could do something
like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"friends"</span>, net<span class="op">=</span><span class="va">g1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age</span>, w<span class="op">=</span><span class="va">..weight..</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> </span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sex</span>, w<span class="op">=</span><span class="va">..weight..</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 45.69134     1    FALSE</span></span>
<span><span class="co">#&gt; 2: 37.05165     0    FALSE</span></span>
<span><span class="co">#&gt; 3: 66.75057     1    FALSE</span></span>
<span><span class="co">#&gt; 4: 36.75051     1       NA</span></span>
<span><span class="co">#&gt; 5: 61.50802     0     TRUE</span></span>
<span><span class="co">#&gt; 6: 63.68616     0     TRUE</span></span></code></pre></div>
<p>It is essentially the same code as before, with the only difference
being that we use <code><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean()</a></code> instead of
<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> to summarize the neighbors’ values and use the edge
weights within this function call, giving stronger connections more
weight. Users are of course free to use the <code>..weight..</code>
variable in any other way as well.</p>
</div>
<div class="section level3">
<h3 id="directed-networks">Directed Networks<a class="anchor" aria-label="anchor" href="#directed-networks"></a>
</h3>
<p>So far we have always assumed that all connections in a graph are
<em>un-directed</em>, e.g. that once there is an edge between vertices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math>,
that they have a reciprocal relationship with each other. In real
networks it is often the case that relationships between vertices are
not reciprocal, but directed. For example, in the professional network
we might be interested in showing who is giving who orders. This could
be done by using a <em>directed</em> network. These kinds of networks
are also directly supported for simulation purposes in this package.</p>
<p>Let us create a random directed network first:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, m<span class="op">=</span><span class="fl">18</span>, directed<span class="op">=</span><span class="cn">TRUE</span>, loops<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, edge.arrow.size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this example, individual 3 can give orders to individual 11, 13
and 14, but cannot be given orders by these individuals. Now lets
suppose we want to only use the values of subordinates (e.g. vertices
connected by outgoing edges) to define neighborhoods. This can be
achieved using the <code>mode</code> argument of the <code><a href="../reference/net.html">net()</a></code>
function. We again replicate the <code>DAG</code> from earlier, changing
it only slightly:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"work"</span>, net<span class="op">=</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">"out"</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> </span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">"out"</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 53.22599     1     TRUE</span></span>
<span><span class="co">#&gt; 2: 52.17259     1    FALSE</span></span>
<span><span class="co">#&gt; 3: 54.58468     0    FALSE</span></span>
<span><span class="co">#&gt; 4: 46.99742     0     TRUE</span></span>
<span><span class="co">#&gt; 5: 33.19981     0     TRUE</span></span>
<span><span class="co">#&gt; 6: 33.78001     1     TRUE</span></span></code></pre></div>
<p>Conversely, if we want to only model the <code>infected</code>
probability as a function of the “bosses” of a node (e.g. the incoming
edges), all we would have to do is set <code>mode="in"</code> in the
<code><a href="../reference/net.html">net()</a></code> calls. If we want to disregard the edge directions,
we could simply keep the <code>mode</code> argument at its default value
of <code>"all"</code>. Since the way the edges are treated is defined
using <code><a href="../reference/net.html">net()</a></code> calls, it is of course also possible to use
mixtures of these strategies in the same node definition, by using
multiple <code><a href="../reference/net.html">net()</a></code> calls with different <code>mode</code>s.
This could also be combined with weights (as described in the previous
section).</p>
</div>
<div class="section level3">
<h3 id="neighborhood-order">Neighborhood order<a class="anchor" aria-label="anchor" href="#neighborhood-order"></a>
</h3>
<p>In all previous examples, we only used the immediate neighbors of a
node in our <code><a href="../reference/net.html">net()</a></code> calls. By using the <code>order</code>
argument of the <code><a href="../reference/net.html">net()</a></code> function, it is also possible to use
larger neighborhoods, meaning that instead of only considering the
directly connected individuals as neighbors, we may also include
individuals that are connected to those and so on. Below we show another
random network where the neighbors of node 11 (colored in green) are
colored in salmon for two different values of <code>order</code>:</p>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If this was a directed network, the neighborhood would of course also
be dependent on the direction of the edges, as described in the previous
section. Below is a simple example on how one could use this
functionality:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2134</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, m<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"net1"</span>, net<span class="op">=</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, order<span class="op">=</span><span class="fl">1</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> </span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, order<span class="op">=</span><span class="fl">2</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 57.71886     1     TRUE</span></span>
<span><span class="co">#&gt; 2: 53.62951     0     TRUE</span></span>
<span><span class="co">#&gt; 3: 61.21526     1     TRUE</span></span>
<span><span class="co">#&gt; 4: 57.20119     1    FALSE</span></span>
<span><span class="co">#&gt; 5: 30.44710     0    FALSE</span></span>
<span><span class="co">#&gt; 6: 45.28895     0    FALSE</span></span></code></pre></div>
<p>Here, we largely replicated the DAG from earlier, but use different
order neighborhoods for the effect of <code>age</code> and
<code>sex</code>. Again, because the <code>order</code> is defined by
individual <code><a href="../reference/net.html">net()</a></code> calls, users may use different values of
<code>order</code> in the same node definition without any issues. Note
that when using <code>order &gt; 1</code> all edge weights are ignored,
because it is not clear what the edge weight should be when considering
indirect connections.</p>
<p>We could also go an additional step further and <em>only</em>
consider the direct connections to neighbors as neighbors, without using
the direct connections themselves. This can be done using the
<code>mindist</code> argument of <code><a href="../reference/net.html">net()</a></code>. Below is another
graph illustrating the difference of using <code>mindist=1</code> and
<code>mindist=2</code> with <code>order=2</code> given the earlier
network:</p>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This might be useful to model extended network effects as direct
effects in a <code>DAG</code>. Repeating the <code>DAG</code> from
earlier (with some slight changes) we could use something like:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2134</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, m<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"net1"</span>, net<span class="op">=</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span>, output<span class="op">=</span><span class="st">"numeric"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>       formula<span class="op">=</span> <span class="op">~</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">age</span><span class="op">*</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span></span>
<span>                  <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, order<span class="op">=</span><span class="fl">2</span>, mindist<span class="op">=</span><span class="fl">2</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age   sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 57.71886     1     TRUE</span></span>
<span><span class="co">#&gt; 2: 53.62951     0    FALSE</span></span>
<span><span class="co">#&gt; 3: 61.21526     1     TRUE</span></span>
<span><span class="co">#&gt; 4: 57.20119     1    FALSE</span></span>
<span><span class="co">#&gt; 5: 30.44710     0    FALSE</span></span>
<span><span class="co">#&gt; 6: 45.28895     0    FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="networks-as-a-function-of-other-variables">Networks as a function of other variables<a class="anchor" aria-label="anchor" href="#networks-as-a-function-of-other-variables"></a>
</h3>
<p>Up to this point we have always created the networks completely
independently from all other variables, which in reality could be
considered unrealistic. Luckily, networks may also be defined as a
function of already generated variables as well. Similar to regular
<code><a href="../reference/node.html">node()</a></code> function calls, it is possible to use the
<code>parents</code> argument to specify that a network is based on
values of the <code>parents</code>. The <code>data</code> of the
<code>parents</code> is then automatically passed to the
<code>data</code> argument of the function that should be used to create
the network, allowing all kinds of dependencies to be implemented by the
user.</p>
<p>Suppose that the goal is to generate data for both males and females.
For some reason there should be essentially separate networks for males
and females. This might for example arise when considering networks in
sports that are separated by sex. To simulate such an example, we first
define some functions:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_different_sex</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">g</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://r.igraph.org/reference/ends.html" class="external-link">ends</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">type</span> <span class="op">!=</span> <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://r.igraph.org/reference/ends.html" class="external-link">ends</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">type</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">gen_network</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_sim</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_sim</span>, m<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">sex</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/delete_edges.html" class="external-link">delete_edges</a></span><span class="op">(</span><span class="va">g</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, <span class="va">is_different_sex</span>,</span>
<span>                                    FUN.VALUE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, g<span class="op">=</span><span class="va">g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here the <code>id_different_sex()</code> function simply takes in an
edge of the graph and checks whether both vertices have the same type.
The <code>gen_network()</code> function first generates a random graph
and then adds the <code>sex</code> contained in the supplied
<code>data</code> as a type to each node. It then deletes all edges
where the type (e.g. <code>sex</code>) of the vertices is not the same.
We can incorporate this into a <code>DAG</code> using:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">25</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"network1"</span>, net<span class="op">=</span><span class="va">gen_network</span>, parents<span class="op">=</span><span class="st">"sex"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"binomial"</span>, formula<span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>We can now simulate from this <code>DAG</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1324</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span>, return_networks<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age    sex infected</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;lgcl&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1: 17.74261   TRUE     TRUE</span></span>
<span><span class="co">#&gt; 2: 33.84116  FALSE     TRUE</span></span>
<span><span class="co">#&gt; 3: 17.13370   TRUE     TRUE</span></span>
<span><span class="co">#&gt; 4: 13.14236   TRUE     TRUE</span></span>
<span><span class="co">#&gt; 5: 33.44052   TRUE     TRUE</span></span>
<span><span class="co">#&gt; 6: 21.95168   TRUE       NA</span></span></code></pre></div>
<p>Note that we set <code>return_networks=TRUE</code>, so that we can
also inspect the generated network. Whenever this is done, the
<code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function actually returns a list containing
both the generated <code>data</code> and the <code>networks</code>.
Below is the generated networks, with different vertex colors for each
<code>sex</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">networks</span><span class="op">$</span><span class="va">network1</span><span class="op">$</span><span class="va">net</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span>, <span class="st">"salmon"</span>, <span class="st">"lightblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This is a fairly artificial example, because it is only meant to
illustrate this functionality in a simple way. Users could of course use
this in much more interesting ways. Because the <code>net</code>
argument allows any function, there are no limits set to how the network
structure should be dependent on the <code>data</code> at hand.</p>
</div>
</div>
<div class="section level2">
<h2 id="networks-in-discrete-time-simulation">Networks in discrete-time simulation<a class="anchor" aria-label="anchor" href="#networks-in-discrete-time-simulation"></a>
</h2>
<p>It is of course also possible to use the outlined
networks-simulation-based approach in discrete-time simulations
conducted using the <code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function. Below we
illustrate how to do this using both static and dynamically changing
networks.</p>
<div class="section level3">
<h3 id="static-networks">Static networks<a class="anchor" aria-label="anchor" href="#static-networks"></a>
</h3>
<p>As a simple example, we will consider the spread of an infectious
disease through a (un-directed and un-weighted) network of 18
individuals and 6 distinct points in time. In this simulation, there is
only one variable of interest: the infection status of a person, denoted
by <code>infected</code> (0 = not infected, 1 = infected). First, we
will generate a random graph of 18 individuals with 30 connections
between them using the <code>igraph</code> package:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">244368</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">18</span>, m<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-27-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We will assume that the probability of infection rises in a very
simple fashion with the number of infected neighbors in the network. At
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t = 1</annotation></semantics></math>
all individuals have a 5% chance of becoming infected through some
unknown external event. From then on, only individuals with infected
neighbors can be infected. In particular, the general probability of
infection at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>0.05</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if</mtext><mspace width="1.0em"></mspace><mi>t</mi><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0.4</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if</mtext><mspace width="1.0em"></mspace><mi>t</mi><mo>&gt;</mo><mn>1</mn><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> and </mtext><mspace width="0.333em"></mspace></mrow><mi>k</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0.9</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if</mtext><mspace width="1.0em"></mspace><mi>t</mi><mo>&gt;</mo><mn>1</mn><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> and </mtext><mspace width="0.333em"></mspace></mrow><mi>k</mi><mo>&gt;</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
    P(t) =
    \begin{cases}
      0.05 &amp; \text{if} \quad t = 1 \\
        0.4 &amp; \text{if} \quad t &gt; 1 \text{ and } k \in (1,2) \\
        0.9 &amp; \text{if} \quad t &gt; 1 \text{ and } k &gt; 3 \\
        0 &amp; \text{otherwise}
    \end{cases},
</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
being the number of infected neighbors of the individual. Additionally,
once infected, a person stays infected. We can simulate this kind of
date using the following code:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_infection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">sim_time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sim_time</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">n_infected_neighbors</span><span class="op">==</span><span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                 <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">n_infected_neighbors</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="fl">0.9</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="st">"net1"</span>, net<span class="op">=</span><span class="va">g2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"n_infected_neighbors"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>          formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infected_event</span><span class="op">)</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, kind<span class="op">=</span><span class="st">"data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, event_duration<span class="op">=</span><span class="cn">Inf</span>,</span>
<span>          immunity_duration<span class="op">=</span><span class="cn">Inf</span>, parents<span class="op">=</span><span class="op">(</span><span class="st">"n_infected_neighbors"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_infection</span><span class="op">)</span></span></code></pre></div>
<p>Here, we first define the <code>prob_infected()</code> function,
which implements the conditional probability distribution defined above.
This function is later used in a <code>"time_to_event"</code> node. We
then define the <code>DAG</code> required for the simulation. First, we
add a single call to <code><a href="../reference/network.html">network()</a></code> to an empty <code>DAG</code>
to allow the usage of network dependencies. We then add a time-dependent
node using <code><a href="../reference/node.html">node_td()</a></code>, which simply calculates the number of
infected neighbors a node has. We then define the final node, which is
<code>infected</code>, using the <code>prob_infected()</code> function
defined earlier.</p>
<p>Now we can run the simulation and transform the output into the
long-format for easier processing:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">18</span>, max_t<span class="op">=</span><span class="fl">6</span>, save_states<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time n_infected_neighbors infected</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;                &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1                    0    FALSE</span></span>
<span><span class="co">#&gt; 2:     1     2                    0    FALSE</span></span>
<span><span class="co">#&gt; 3:     1     3                    1    FALSE</span></span>
<span><span class="co">#&gt; 4:     1     4                    2    FALSE</span></span>
<span><span class="co">#&gt; 5:     1     5                    2     TRUE</span></span>
<span><span class="co">#&gt; 6:     1     6                    3     TRUE</span></span></code></pre></div>
<p>Using a simple <code>for</code> loop and the
<code><a href="https://r.igraph.org/reference/plot.igraph.html" class="external-link">plot.igraph()</a></code> function (with some cosmetic changes), we can
also visualize the spread of the infection on the network. Below are the
resulting 6 figures, which show the network at each point in time of the
simulation, with the infected individuals colored in salmon and the
not-infected individuals colored in lightblue:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"lightgray"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">.time</span><span class="op">==</span><span class="va">i</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data_i</span><span class="op">$</span><span class="va">infected</span>, <span class="st">"salmon"</span>, <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g2</span>,</span>
<span>       vertex.label.cex<span class="op">=</span><span class="fl">0.8</span>,</span>
<span>       vertex.label.color<span class="op">=</span><span class="st">"black"</span>,</span>
<span>       size<span class="op">=</span><span class="fl">1</span>,</span>
<span>       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t = "</span>, <span class="va">i</span><span class="op">)</span>,</span>
<span>       layout<span class="op">=</span><span class="fu"><a href="https://r.igraph.org/reference/layout_nicely.html" class="external-link">layout_nicely</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span>,</span>
<span>       margin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The infection started with only individual 14 being infected (the
index case). From there it spread immediately to individuals 2 and 8 and
continued from there, as an actual infection might have. It would of
course also be possible to make the probability generating function more
realistic, or to add further variables such as vaccinations.</p>
</div>
<div class="section level3">
<h3 id="dynamic-networks">Dynamic networks<a class="anchor" aria-label="anchor" href="#dynamic-networks"></a>
</h3>
<p>In all previous examples, the network structure itself never changed,
because we only used a single <code><a href="../reference/network.html">network()</a></code> call defining a
static network. Below we extend our approach to the case of
<em>dynamic</em> networks, that may change over time (possibly as a
function of other fixed or time-varying variables).</p>
<div class="section level4">
<h4 id="random-new-networks-at-each-point-in-time">Random new networks at each point in time<a class="anchor" aria-label="anchor" href="#random-new-networks-at-each-point-in-time"></a>
</h4>
<p>Let us start with the easiest type of dynamic network that we can
imagine: a network structure that changes entirely at every single point
in time without any correlation to what it previously looked like or to
what has happened to the individuals in it. We can do this using almost
the same code that we used earlier. The main difference for any
situation in which dynamic networks should be used is that we need to
define a function that generates the network for us. Below is one
possibility:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen_network</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_sim</span>, m<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The only requirement for the function is that it has a single named
argument called <code>n_sim</code>, which controls the size of the
network (number of vertices in it). In the function above, this argument
is simply passed to the <code><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm()</a></code> function of the
<code>igraph</code> package that we already used earlier. We can now use
almost the same code as we did before to generate data using this
function:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"n_infected_neighbors"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>          formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infected_event</span><span class="op">)</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, kind<span class="op">=</span><span class="st">"data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, event_duration<span class="op">=</span><span class="cn">Inf</span>,</span>
<span>          immunity_duration<span class="op">=</span><span class="cn">Inf</span>, parents<span class="op">=</span><span class="op">(</span><span class="st">"n_infected_neighbors"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_infection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network_td</a></span><span class="op">(</span><span class="st">"net1"</span>, net<span class="op">=</span><span class="va">gen_network</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1335</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">18</span>, max_t<span class="op">=</span><span class="fl">6</span>, save_states<span class="op">=</span><span class="st">"all"</span>,</span>
<span>                         save_networks<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time n_infected_neighbors infected</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;                &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1                    0    FALSE</span></span>
<span><span class="co">#&gt; 2:     1     2                    0    FALSE</span></span>
<span><span class="co">#&gt; 3:     1     3                    1    FALSE</span></span>
<span><span class="co">#&gt; 4:     1     4                    1     TRUE</span></span>
<span><span class="co">#&gt; 5:     1     5                    3     TRUE</span></span>
<span><span class="co">#&gt; 6:     1     6                    5     TRUE</span></span></code></pre></div>
<p>The only difference to the previous code is that we used
<code><a href="../reference/network.html">network_td()</a></code> instead of <code><a href="../reference/network.html">network()</a></code>, passing the
function to the <code>net</code> argument. Everything else is the same.
The code to visualize the spread of the disease is also very similar,
with the one change being that we now have one network per slide (saved
in the <code>sim</code> object because we set
<code>save_networks=TRUE</code>):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">.time</span><span class="op">==</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">g_i</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">past_networks</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">net1</span><span class="op">$</span><span class="va">net</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g_i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"lightgray"</span></span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g_i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data_i</span><span class="op">$</span><span class="va">infected</span>, <span class="st">"salmon"</span>, <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_i</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.8</span>,</span>
<span>       vertex.label.color<span class="op">=</span><span class="st">"black"</span>,</span>
<span>       size<span class="op">=</span><span class="fl">1</span>,</span>
<span>       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t = "</span>, <span class="va">i</span><span class="op">)</span>,</span>
<span>       layout<span class="op">=</span><span class="fu"><a href="https://r.igraph.org/reference/layout_nicely.html" class="external-link">layout_nicely</a></span><span class="op">(</span><span class="va">g_i</span><span class="op">)</span>,</span>
<span>       margin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Here, the simulation starts out with individuals 8 being infected,
while being connected to individuals 3, 7, 11, 15 and 16 at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t = 1</annotation></semantics></math>.
This individual then spread the infection to individuals 3 and 15, as
can be seen at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">t = 2</annotation></semantics></math>.
However, the network has changed completely at this point. Now the
individuals are connected to others, spreading the infection even
further to those they are connected with now. This repeats until almost
everyone (except individuals 4 and 12) are infected. Note that it makes
a significant difference in which order the <code><a href="../reference/node.html">node_td()</a></code> and
<code><a href="../reference/network.html">network_td()</a></code> calls are added, as in usual simulations using
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="adjusting-a-network-over-time">Adjusting a network over time<a class="anchor" aria-label="anchor" href="#adjusting-a-network-over-time"></a>
</h4>
<p>Lets move to a more useful example, in which the network is initiated
once at the beginning and changed slightly over time instead of
re-drawing it every time. As an example, we will again extend the
earlier infectious disease example. In this new example, the government
is trying to contain the epidemic by isolating infected individuals. The
act of isolation in this context means, that an infected individual is
put under quarantine and is not allowed to have any contact to other
individuals, which translates to removing all connections the infected
individual has in the network. We will assume that the government is
able to perfectly enforce the isolation, but that it is a little slow in
doing so. Only after one full day of being sick does the government
realize that an individual is infected.</p>
<p>First, we have to adjust the <code>gen_network()</code> function. We
will use the following code:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen_network</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_sim</span>, <span class="va">sim_time</span>, <span class="va">network</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sim_time</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_sim</span>, m<span class="op">=</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">rm_edges</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">.id</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">infected_event</span><span class="op">==</span><span class="cn">TRUE</span> <span class="op">&amp;</span></span>
<span>                       <span class="va">data</span><span class="op">$</span><span class="va">infected_time_since_last</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rm_edges</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rm_edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://r.igraph.org/reference/incident_edges.html" class="external-link">incident_edges</a></span><span class="op">(</span><span class="va">network</span>, <span class="va">rm_edges</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">g_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/delete_edges.html" class="external-link">delete_edges</a></span><span class="op">(</span><span class="va">network</span>, <span class="va">rm_edges</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">g_new</span> <span class="op">&lt;-</span> <span class="va">network</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">g_new</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>There is a few lines of obscure code here, but generally what the
function does is really simple. At
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>
it simply generates a random graph using <code><a href="https://r.igraph.org/reference/sample_gnm.html" class="external-link">sample_gnm()</a></code>. From
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t = 1</annotation></semantics></math>
on it simply checks whether any person is infected and isolates them, by
deleting their connections and returning the adjusted network. By adding
the time-dependent networks after the time-dependent nodes in the
<code>DAG</code>, we ensure that it is updated only after all nodes of a
day have been generated. Because the <code>time_since_last</code>
counter of the <code>infected</code> node starts at 0 using
<code>data$infected_time_since_last &gt; 0</code> ensures that each
individual has one full day to spread the infection. Note that the
arguments <code>sim_time</code>, <code>network</code> and
<code>data</code> are automatically passed internally.
<code>sim_time</code> is the current simulation time,
<code>network</code> is the current state of the network and
<code>data</code> is the current state of the data.</p>
<p>We can now re-use almost the same <code>DAG</code> definition from
earlier:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"n_infected_neighbors"</span>, type<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>          formula<span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/net.html">net</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infected_event</span><span class="op">)</span>, na<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, kind<span class="op">=</span><span class="st">"data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"infected"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, event_duration<span class="op">=</span><span class="cn">Inf</span>,</span>
<span>          immunity_duration<span class="op">=</span><span class="cn">Inf</span>, parents<span class="op">=</span><span class="op">(</span><span class="st">"n_infected_neighbors"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_infection</span>, time_since_last<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/network.html">network_td</a></span><span class="op">(</span><span class="st">"net1"</span>, net<span class="op">=</span><span class="va">gen_network</span>, create_at_t0<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The only difference to before is that we actively set
<code>create_at_t0=TRUE</code> so that the network gets created before
time-dependent processing starts (so we have a network to adjust at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t = 1</annotation></semantics></math>)
and that we set <code>time_since_last=TRUE</code> in the
<code>infected</code> node to track the time since the original
infection, because we need that information in the network generating
function. Lets run the simulation again:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">13354</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">18</span>, max_t<span class="op">=</span><span class="fl">6</span>, save_states<span class="op">=</span><span class="st">"all"</span>,</span>
<span>                         save_networks<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time n_infected_neighbors infected infected_time_since_last</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;                &lt;num&gt;   &lt;lgcl&gt;                    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1                    0    FALSE                       NA</span></span>
<span><span class="co">#&gt; 2:     1     2                    1    FALSE                       NA</span></span>
<span><span class="co">#&gt; 3:     1     3                    1     TRUE                        0</span></span>
<span><span class="co">#&gt; 4:     1     4                    0     TRUE                        1</span></span>
<span><span class="co">#&gt; 5:     1     5                    0     TRUE                        2</span></span>
<span><span class="co">#&gt; 6:     1     6                    0     TRUE                        3</span></span></code></pre></div>
<p>In the first few rows of the data we can already see that the number
of infected individuals does not And finally lets plot the resulting
infection spread again:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layout_g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/layout_nicely.html" class="external-link">layout_nicely</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">past_networks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">net1</span><span class="op">$</span><span class="va">net</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">.time</span><span class="op">==</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">g_i</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">past_networks</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">net1</span><span class="op">$</span><span class="va">net</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g_i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"lightgray"</span></span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g_i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data_i</span><span class="op">$</span><span class="va">infected</span>, <span class="st">"salmon"</span>, <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_i</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.8</span>,</span>
<span>       vertex.label.color<span class="op">=</span><span class="st">"black"</span>,</span>
<span>       size<span class="op">=</span><span class="fl">1</span>,</span>
<span>       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t = "</span>, <span class="va">i</span><span class="op">)</span>,</span>
<span>       layout<span class="op">=</span><span class="va">layout_g</span>,</span>
<span>       margin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="v_sim_networks_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;"></p>
<p>As can be seen, due to the timely delay of the isolation, the
infection is still able to spread, but it cannot reach all individuals.
Near the end of the simulation, practically all connections are removed,
making it impossible for the infection to spread further. This is by no
means a realistic example, but it showcases how changing networks might
be utilized in this package.</p>
<p>This simulation could easily be extended to make the isolation
non-permanent, by re-adding the removed connections after a pre-defined
duration, or could be even further extended by adding vaccinations or
other variables. Additionally, although not shown in this vignette, it
would of course also be possible to use the other features shown for
regular simulations (weighted or directed networks, multiple networks,
etc.) in discrete-time simulation as well.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>Networks-based simulations offer an additional amount of flexibility
in specifying data generation processes (DGP) that is usually not
included in general-purpose simulation software. By making
cross-individual dependencies possible through one or multiple networks
and allowing those to also be influenced by individual-level variables,
almost any kind of data can be generated. The <code>simDAG</code>
package offers a simple and consistent syntax to perform such
simulations. Network dependencies are fully integrated into the enhanced
<code>formula</code> syntax through the <code><a href="../reference/net.html">net()</a></code> function,
which hopefully makes the barrier to use this methodology a lot less
daunting for potential users.</p>
<p>Despite the great flexibility offered by this approach, it is used
quite infrequently in practice. The preprint published by <span class="citation">Sofrygin, Neugebauer, and van der Laan (2017)</span>
did not gather a lot of attention, even though they also offered a clean
and powerful implementation of the method through the
<code>simcausal</code> <span class="citation">(Sofrygin, van der Laan,
and Neugebauer 2017)</span> package (which heavily inspired the
presented <code>simDAG</code> implementation). I suspect that the main
reason for this is that there are only few statistical models designed
to actually analyze data with such complex DGPs. Despite recent
advancements, the combination of network science and causal inference is
still in its infancy, as has been pointed out by others <span class="citation">(Ogburn et al. 2024; VanderWeele and An 2013; An,
Beauvile, and Rosche 2022)</span>. I hope that this implementation will
make future investigations into this subject easier or at least more
convenient to methodological researchers.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-An2022" class="csl-entry">
An, Weihua, Roberson Beauvile, and Benjamin Rosche. 2022. <span>“Causal
Network Analysis.”</span> <em>Annual Reviews of Sociology</em> 48:
23–41. <a href="https://doi.org/10.1146/annurev-soc-030320-102100" class="external-link">https://doi.org/10.1146/annurev-soc-030320-102100</a>.
</div>
<div id="ref-Danon2011" class="csl-entry">
Danon, Leon, Ashley P. Ford, Thomas House, Chris P. Jewell, Matt J.
Keeling, Gareth O. Roberts, Joshua V. Ross, and Matthew C. Vernon. 2011.
<span>“Networks and the Epidemiology of Infectious Disease.”</span>
<em>Interdisciplinary Perspectives on Infectious Diseases</em> 16. <a href="https://doi.org/10.1155/2011/284909" class="external-link">https://doi.org/10.1155/2011/284909</a>.
</div>
<div id="ref-Denz2025" class="csl-entry">
Denz, Robin, and Nina Timmesfeld. 2025. <span>“Simulating Complex
Crossectional and Longitudinal Data Using the simDAG r Package.”</span>
<em>arXiv Preprint</em>. <a href="https://doi.org/10.48550/arXiv.2506.01498" class="external-link">https://doi.org/10.48550/arXiv.2506.01498</a>.
</div>
<div id="ref-Ogburn2024" class="csl-entry">
Ogburn, Elizabeth L., Oleg Sofrygin, Iván Díaz, and Mark J. van der
Laan. 2024. <span>“Causal Inference for Social Network Data.”</span>
<em>Journal of the American Statistical Association</em> 119 (545):
597–611. <a href="https://doi.org/10.1080/01621459.2022.2131557" class="external-link">https://doi.org/10.1080/01621459.2022.2131557</a>.
</div>
<div id="ref-Sofrygin2017a" class="csl-entry">
Sofrygin, Oleg, Romain Neugebauer, and Mark J. van der Laan. 2017.
<span>“Conducting Simulations in Causal Inference with Networks-Based
Structural Equation Models.”</span> arXiv prepring. <a href="https://doi.org/10.48550/arXiv.1705.10376" class="external-link">https://doi.org/10.48550/arXiv.1705.10376</a>.
</div>
<div id="ref-Sofrygin2017" class="csl-entry">
Sofrygin, Oleg, Mark J. van der Laan, and Romain Neugebauer. 2017.
<span>“Simcausal r Package: Conducting Transparent and Reproducible
Simulation Studies of Causal Effect Estimation with Complex Longitudinal
Data.”</span> <em>Journal of Statistical Software</em> 81 (2): 1–47. <a href="https://doi.org/10.18637/jss.v081.i02" class="external-link">https://doi.org/10.18637/jss.v081.i02</a>.
</div>
<div id="ref-VanderWeele2013" class="csl-entry">
VanderWeele, Tyler J., and Weihua An. 2013. <span>“Social Networks and
Causal Inference.”</span> In <em>Handbook of Causal Analysis for Social
Research</em>, edited by Stephen L. Morgan. Dordrecht: Springer Science
+ Business Media. <a href="https://doi.org/10.1007/978-94-007-6094-3" class="external-link">https://doi.org/10.1007/978-94-007-6094-3</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
