<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Specifying Custom Node Types in a DAG • simDAG</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specifying Custom Node Types in a DAG">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/simDAG.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_custom_nodes.html">Specifying Custom Node Types in a DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_cookbook.html">simDAG Cookbook</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Specifying Custom Node Types in a DAG</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/siMDAG/blob/main/vignettes/v_custom_nodes.Rmd" class="external-link"><code>vignettes/v_custom_nodes.Rmd</code></a></small>
      <div class="d-none name"><code>v_custom_nodes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this small vignette, we give a detailed explanation on how to
define custom functions that can be used in the <code>type</code>
argument of <code><a href="../reference/node.html">node()</a></code> or <code><a href="../reference/node.html">node_td()</a></code> calls.
Although <code>simDAG</code> includes a large number of different node
types that can be used in this argument directly, it also allows the
user to pass any function to this argument, as long as that function
meets some limited criteria (as described below). This is an advanced
feature that most users probably don’t need for standard simulation
studies. We strongly recommend reading the documentation and the other
vignettes first, because this vignette assumes that the reader is
already familiar with the <code>simDAG</code> syntax and general
features.</p>
<p>The support for custom functions in <code>type</code> allows users to
create root nodes, child nodes or time-dependent nodes that are not
directly implemented in this package. By doing so, users may create data
with any functional dependence they can think of. The requirements for
each node type are listed below. Some simple examples for each node type
are given in each section. If you think that your custom node type might
be useful to others, please contact the maintainer of this package via
the supplied e-mail address or github and we might add it to this
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="root-nodes">Root Nodes<a class="anchor" aria-label="anchor" href="#root-nodes"></a>
</h2>
<div class="section level3">
<h3 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h3>
<p>Any function that generates some vector of size <code>n</code> with
<code>n==nrow(data)</code>, or a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> with as many
rows as the current data can be used as a child node. The only
requirement is:</p>
<ul>
<li>
<strong>1.)</strong> The function should have an argument called
<code>n</code> which controls how many samples to generate.</li>
</ul>
<p>Some examples that are already implemented in R outside of this
package are <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">stats::rnorm()</a></code>, <code><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">stats::rgamma()</a></code>
and <code><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">stats::rbeta()</a></code>. The function may take any amount of
further arguments, which will be passed through the three-dot
(<code>...</code>) syntax. Note that whenever the supplied function
produces a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> (or similar object), the user has
to ensure that the included columns are named properly.</p>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>Using external functions that fulfill the requirements which are
already defined by some other package can be done this way:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="st">"rgamma"</span>, shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"B"</span>, type<span class="op">=</span><span class="st">"rbeta"</span>, shape1<span class="op">=</span><span class="fl">2</span>, shape2<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p>Of course users may also define an appropriate root node function
themselves. The code below defines a function that takes the sum of a
normally distributed random number and a uniformly distributed random
number for each simulated individual:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_root</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">min</span><span class="op">=</span><span class="fl">0</span>, <span class="va">max</span><span class="op">=</span><span class="fl">1</span>, <span class="va">mean</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min<span class="op">=</span><span class="va">min</span>, max<span class="op">=</span><span class="va">max</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">mean</span>, sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># the function may be supplied as a string</span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="st">"custom_root"</span>, min<span class="op">=</span><span class="fl">0</span>, max<span class="op">=</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equivalently, the function can also be supplied directly</span></span>
<span><span class="co"># This is the recommended way!</span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="va">custom_root</span>, min<span class="op">=</span><span class="fl">0</span>, max<span class="op">=</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span>dag<span class="op">=</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;            A</span></span>
<span><span class="co">#&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  2.524972</span></span>
<span><span class="co">#&gt; 2: 10.058842</span></span>
<span><span class="co">#&gt; 3:  8.874968</span></span>
<span><span class="co">#&gt; 4:  9.203870</span></span>
<span><span class="co">#&gt; 5: 13.284535</span></span>
<span><span class="co">#&gt; 6: 12.529218</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="child-nodes">Child Nodes<a class="anchor" aria-label="anchor" href="#child-nodes"></a>
</h2>
<div class="section level3">
<h3 id="requirements-1">Requirements<a class="anchor" aria-label="anchor" href="#requirements-1"></a>
</h3>
<p>Again, almost any function may be used to generate a child node. Only
four things are required for this to work properly:</p>
<ul>
<li>
<strong>1.)</strong> Its’ name should start with <code>node_</code>
(if you want to use a string to define it in <code>type</code>).</li>
<li>
<strong>2.)</strong> It should contain an argument called
<code>data</code> (contains the already generated data).</li>
<li>
<strong>3.)</strong> It should contain an argument called
<code>parents</code> (contains a vector of the child nodes
parents).</li>
<li>
<strong>4.)</strong> It should return either a vector of length
<code>n_sim</code> or a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> (or similar object)
with any number of columns and <code>n_sim</code> rows.</li>
</ul>
<p>The function may include any amount of additional arguments specified
by the user.</p>
</div>
<div class="section level3">
<h3 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<p>Below we define a custom child node type that is basically just a
gaussian node with some (badly done) truncation, limiting the range of
the resulting variable to be between <code>left</code> and
<code>right</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_gaussian_trunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span>, <span class="va">betas</span>, <span class="va">intercept</span>, <span class="va">error</span>,</span>
<span>                                <span class="va">left</span>, <span class="va">right</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node_gaussian.html">node_gaussian</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, parents<span class="op">=</span><span class="va">parents</span>, betas<span class="op">=</span><span class="va">betas</span>,</span>
<span>                       intercept<span class="op">=</span><span class="va">intercept</span>, error<span class="op">=</span><span class="va">error</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&lt;=</span> <span class="va">left</span>, <span class="va">left</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&gt;=</span> <span class="va">right</span>, <span class="va">right</span>, <span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Please note that this is a terrible form of truncation in most cases,
because it artificially distorts the resulting normal distribution at
the <code>left</code> and <code>right</code> values. It is only meant as
an illustration. Here is another example of a custom child node
function, which simply returns the sum of its parents:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parents_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span>, <span class="va">betas</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">parents</span>, with<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can use both of these functions in a DAG like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"custom_1"</span>, type<span class="op">=</span><span class="st">"gaussian_trunc"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>       betas<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.4</span><span class="op">)</span>, intercept<span class="op">=</span><span class="op">-</span><span class="fl">2</span>, error<span class="op">=</span><span class="fl">2</span>, left<span class="op">=</span><span class="fl">10</span>, right<span class="op">=</span><span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"custom_2"</span>, type<span class="op">=</span><span class="va">parents_sum</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"custom_1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span>dag<span class="op">=</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age    sex custom_1 custom_2</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;lgcl&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 48.49105   TRUE 17.33651 65.82756</span></span>
<span><span class="co">#&gt; 2: 50.39048   TRUE 17.34963 67.74011</span></span>
<span><span class="co">#&gt; 3: 56.55498   TRUE 21.36313 77.91811</span></span>
<span><span class="co">#&gt; 4: 46.49763  FALSE 18.61867 65.11630</span></span>
<span><span class="co">#&gt; 5: 50.48704   TRUE 19.34207 69.82911</span></span>
<span><span class="co">#&gt; 6: 55.44852   TRUE 19.98135 75.42988</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="time-dependent-nodes">Time-Dependent Nodes<a class="anchor" aria-label="anchor" href="#time-dependent-nodes"></a>
</h2>
<div class="section level3">
<h3 id="requirements-2">Requirements<a class="anchor" aria-label="anchor" href="#requirements-2"></a>
</h3>
<p>By time-dependent nodes we mean nodes that are created using the
<code><a href="../reference/node.html">node_td()</a></code> function. In general, this works in essentially
the same way as for simple root nodes or child nodes. The requirements
are:</p>
<ul>
<li>
<strong>1.)</strong> Its’ name should start with <code>node_</code>
(if you want to use a string to define it in <code>type</code>).</li>
<li>
<strong>2.)</strong> It should contain an argument called
<code>data</code> (contains the already generated data).</li>
<li>
<strong>3.)</strong> If it is a child node, it should contain an
argument called <code>parents</code> (contains a vector of the child
nodes parents). This is not necessary for nodes that are independently
generated.</li>
<li>
<strong>4.)</strong> It should return either a vector of length
<code>n_sim</code> or a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> (or similar object)
with any number of columns and <code>n_sim</code> rows.</li>
</ul>
<p>Again, any number of additional arguments is allowed and will be
passed through the three-dot syntax. Additionally, there are two
build-in arguments that users may specify in custom time-dependent
nodes, which are then used internally. First, users may add an argument
to this function called <code>sim_time</code>. If included in the
function definition, the current time of the simulation will be passed
to the function on every call made to it. Secondly, the argument
<code>past_states</code> may be added. If done so, a list containing all
previous states of the simulation (as saved using the
<code>save_states</code> argument of the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function) will be passed to it
internally, giving the user access to the data generated at previous
points in time.</p>
</div>
<div class="section level3">
<h3 id="examples-2">Examples<a class="anchor" aria-label="anchor" href="#examples-2"></a>
</h3>
<div class="section level4">
<h4 id="time-dependent-root-nodes">Time-Dependent Root Nodes<a class="anchor" aria-label="anchor" href="#time-dependent-root-nodes"></a>
</h4>
<p>An example for a custom time-dependent root node is given below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_custom_root_td</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">n</span>, <span class="va">mean</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">mean</span>, sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function simply draws a new value from a normal distribution at
each point in time of the simulation. A DAG using this node type could
look like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Something"</span>, type<span class="op">=</span><span class="va">node_custom_root_td</span>, n<span class="op">=</span><span class="va">n_sim</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-child-nodes">Time-Dependent Child Nodes<a class="anchor" aria-label="anchor" href="#time-dependent-child-nodes"></a>
</h4>
<p>Below is an example for a function that can be used to define a
custom time-dependent child node:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_custom_child</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">)</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">)</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"other"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, prob_fun<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"whatever"</span>, type<span class="op">=</span><span class="st">"custom_child"</span>, parents<span class="op">=</span><span class="st">"other_event"</span><span class="op">)</span></span></code></pre></div>
<p>This function takes a random draw from a normal distribution with
different specifications based on whether a previously updated
time-dependent node called <code>other</code> is currently
<code>TRUE</code> or <code>FALSE</code>.</p>
</div>
<div class="section level4">
<h4 id="using-the-sim_time-argument">Using the <code>sim_time</code> Argument<a class="anchor" aria-label="anchor" href="#using-the-sim_time-argument"></a>
</h4>
<p>Below we give an example on how the <code>sim_time</code> argument
may be used. The following function simply returns the square of the
current simulation time as output:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_square_sim_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">sim_time</span>, <span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sim_time</span><span class="op">^</span><span class="fl">2</span>, n<span class="op">=</span><span class="va">n_sim</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"unclear"</span>, type<span class="op">=</span><span class="va">node_square_sim_time</span>, n_sim<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Note that we did not (and should not!) actually define the
<code>sim_time</code> argument in the <code><a href="../reference/node.html">node_td()</a></code> definition
of the node, because it will be passed internally, just like
<code>data</code> is. As long as <code>sim_time</code> is a named
argument of the function the user is passing, it will be handled
automatically. In real simulation studies this feature may be used to
create time-scale dependent risks or effects for some time-dependent
events of interest.</p>
</div>
<div class="section level4">
<h4 id="using-the-past_states-argument">Using the <code>past_states</code> Argument<a class="anchor" aria-label="anchor" href="#using-the-past_states-argument"></a>
</h4>
<p>As stated earlier, another special kind of argument is the
<code>past_states</code> argument, which allows users direct access to
past states of the simulation. Below is an example of how this might be
used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_prev_state</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">past_states</span>, <span class="va">sim_time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sim_time</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">past_states</span><span class="op">[[</span><span class="va">sim_time</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">A</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="va">node_prev_state</span>, parents<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p>This function simply returns the value used two simulation time steps
ago plus a normally distributed random value. To make this happen, we
actually use both the <code>sim_time</code> argument
<strong>and</strong> the <code>past_states</code> argument. Note that,
again, we do not (and cannot!) define these arguments in the
<code><a href="../reference/node.html">node_td()</a></code> definition of the node. They are simply used
internally.</p>
<p>A crucial thing to make the previous code work in an actual
simulation is the <code>save_states</code> argument of the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function. This argument controls which
states should be saved internally. If users want to use previous states,
these need to be saved, so the argument should in almost all cases be
set to <code>save_states="all"</code>, as shown below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span>, max_t<span class="op">=</span><span class="fl">10</span>, save_states<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-the-formula-interface">Using the Formula Interface<a class="anchor" aria-label="anchor" href="#using-the-formula-interface"></a>
</h2>
<p>Users may also use the enhanced <code>formula</code> interface
directly with custom child nodes and custom time-dependent nodes. This
is described in detail in the vignette on specifying formulas (see
<code><a href="../articles/v_using_formulas.html">vignette(topic="v_using_formulas", package="simDAG")</a></code>).</p>
</div>
<div class="section level2">
<h2 id="some-general-comments">Some General Comments<a class="anchor" aria-label="anchor" href="#some-general-comments"></a>
</h2>
<p>Using custom functions as node types is an advanced technique to
obtain specialized simulated data. It is sadly impossible to cover all
user cases here, but we would like to give some general recommendations
nonetheless:</p>
<ul>
<li>When using custom nodes, pass the function to <code>type</code>
directly, do not use a string. This might avoid some weird scoping
issues, depending on which environment the simulation is performed
in.</li>
<li>Keep it simple, if u can. Particularly in time-dependent
simulations, the computational complexity of the node function matters a
lot.</li>
<li>Consider if <code><a href="../reference/node_identity.html">node_identity()</a></code> might be used instead. In
many cases, it is a lot easier to just use a node of type
<code>identity</code> instead of defining a new function.</li>
<li>The structural equations printed for custom nodes may be
uninformative.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
