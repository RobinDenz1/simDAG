<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulating Data using a Discrete-Time Approach • simDAG</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating Data using a Discrete-Time Approach">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulating Data using a Discrete-Time Approach</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/siMDAG/blob/main/vignettes/v_sim_discrete_time.Rmd" class="external-link"><code>vignettes/v_sim_discrete_time.Rmd</code></a></small>
      <div class="d-none name"><code>v_sim_discrete_time.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this small vignette, we introduce the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function, which can be used to generate
arbitrarily complex longitudinal data with discrete points in time. Just
as the <code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function contained in this package,
it allows any mixture of continuous, binary, categorical, count, or
time-to-event data. The main advantage of the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function is that it naturally generates
longitudinal data without the need to define a node for each variable at
each point in time. It also makes the generation of complex
time-to-event data a lot easier. Features such as time-dependent
effects, time-dependent covariates, any form of censoring,
recurrent-events and competing events may be included in a
straightforward fashion.</p>
</div>
<div class="section level2">
<h2 id="what-is-discrete-time-simulation-and-why-use-it">What is Discrete-Time Simulation and Why Use it?<a class="anchor" aria-label="anchor" href="#what-is-discrete-time-simulation-and-why-use-it"></a>
</h2>
<p>A discrete-time simulation (DTS) consists of two steps. First, a
bunch of entities (usually but not necessarily people) are created.
Afterwards, the change of the states of these entities over time is
simulated by increasing the simulation time iteratively in discrete
steps, updating the states at each step (Tang et al. 2020). For example,
suppose that the entities are people and that we are interested in the
states <code>age</code> and <code>death</code>. Every time the
simulation time increases, the <code>age</code> of each person increases
with it, raising the probability of death. At every step we check if
each person is still alive. If they die, the state of <code>death</code>
changes from 0 to 1. If everyone is dead, we stop the simulation. The
schematic flow of DTS is shown in the figure below.</p>
<div class="figure" style="text-align: center">
<img src="images_v_sim_discrete_time%2Fflow_chart.png" alt="A generalized flow-chart of the discrete-time simulation approach" width="500"><p class="caption">
A generalized flow-chart of the discrete-time simulation approach
</p>
</div>
<p>The <code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> directly implements this
workflow. A data set at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>
is either simulated using the <code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function or
supplied directly by the user (using the <code>t0_data</code> argument).
This data set is then updated according to the time-dependent nodes
added to the <code>dag</code> using <code><a href="../reference/node.html">node_td()</a></code> calls. Below
we give a short example on how this works in practice. A more realistic
(and therefore more complex) example can be found in a different
vignette.</p>
<p>A DTS can be seen as a special case of simulation modeling. It is
closely related to <em>dynamic microsimulation</em> (Spooner et
al. 2021), <em>discrete-event simulation</em> (Banks 2014) and
<em>agent-based modeling</em> (Ugur &amp; Saka 2006). As such, it
requires a lot of input from the users. In general, the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function is not an “off-the-shelves”
function which can be used “as-is” to simulate data. In most cases, the
user needs to write their own functions to actually use this function
effectively. This is the price one has to pay for the nearly unlimited
flexibility of this simulation methodology. Nevertheless, it may be the
only valid simulation strategy when the user is interested in highly
complex longitudinal time-to-event data.</p>
</div>
<div class="section level2">
<h2 id="defining-the-dag">Defining the DAG<a class="anchor" aria-label="anchor" href="#defining-the-dag"></a>
</h2>
<p>Similar to the <code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function, the user needs
to specify the nodes of the underlying causal DAG to use this function.
All variables in a DTS can be categorized into three categories:
<em>t0_root nodes</em>, <em>t0_child_nodes</em> and
<em>tx_nodes</em>.</p>
<ul>
<li><p><em>t0_root_nodes</em>: Variables that are completely independent
of all other variables and are only generated once are called
<em>t0_root_nodes</em>. This could be something like sex or geographic
entities. They are generally simply sampled from some previously defined
distribution, but they could also be sampled directly from existing
data. The prefix <em>t0_</em> indicates that these variables are created
only once in the beginning.</p></li>
<li><p><em>t0_child_nodes</em>: Much like <em>t0_root_nodes</em>, the
<em>t0_child_nodes</em> are also variables that are generated only once
in the beginning of the discrete-time simulation. The only difference
is, that these variables are not simply sampled from a defined
distribution. Instead they causally depend in some way on other
variables. Those other variables can be root nodes or other child nodes,
as long as the underlying causal structure can be described as a
directed acyclic graph.</p></li>
<li><p><em>tx_nodes</em>: This type of node is more complex and is the
reason to use DTS. Variables in this category are updated at each step
in time of the simulation process. These updates can be fairly easy,
such as increasing the age of a person by one time unit on each step, or
they can be very complex. For example, if we want to model the
occurrence of some kind of time-dependent-event, we can generate the
probability of that occurrence at each step depending on other variables
in the simulation model or past states of the variable itself.</p></li>
</ul>
<p>The <code>t0_root_nodes</code> and <code>t0_child_nodes</code>
arguments are specified using a <code>DAG</code> object and calls to the
<code><a href="../reference/node.html">node()</a></code> function as usual when using the
<code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function. In fact, they are simply passed to
it under the hood. Their role in the data generation process is only to
obtain the initial data set we need for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>.
It would be equivalent to call the <code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> function
manually and then pass the output to the <code>t0_data</code> argument.
We therefore won’t go into more detail here. More information about how
to correctly specify this DAG can be found in the documentation of the
<code><a href="../reference/sim_from_DAG.html">sim_from_dag()</a></code> and <code><a href="../reference/node.html">node()</a></code> functions or the
associated vignette.</p>
</div>
<div class="section level2">
<h2 id="a-simple-example---one-terminal-event">A Simple Example - One Terminal Event<a class="anchor" aria-label="anchor" href="#a-simple-example---one-terminal-event"></a>
</h2>
<p>Let us consider a very simple example first. Suppose we want to
generate data according to the following causal DAG:</p>
<div class="figure" style="text-align: center">
<img src="images_v_sim_discrete_time%2Fsimple_dag.png" alt="A small DAG with time-varying age"><p class="caption">
A small DAG with time-varying age
</p>
</div>
<p>Here, <code>sex</code> is a time-invariant variable, whereas
<code>age</code> and <code>death</code> are not. Suppose that each tick
of the simulation corresponds to a duration of one year. Then,
naturally, people will age one year on every simulation tick. We assume
that <code>sex</code> and <code>age</code> have a direct causal effect
on the probability of death, regardless of the time. Once people are
dead, they stay dead (no reincarnation allowed).</p>
<p>If we want to use this structure in the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function, we first have to generate an
initial dataset for the state of the population at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>
as described above. We do this by first specifying the
<code>t0_root_nodes</code> as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">30</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>We assume that <code>age</code> is normally distributed and that we
have equal numbers of each <code>sex</code>. This information is enough
to specify the data set at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>.
Now we only need to add additional time-dependent nodes using the
<code><a href="../reference/node.html">node_td()</a></code> function and we are ready. First, we define a
function that increases the age of all individuals by 1 at each
step:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_advance_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">age</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we need to define a function that will return the probability
of <code>death</code> for every individual at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
given their current <code>age</code> and their <code>sex</code>. We use
a logistic regression model, but make it explicit for exemplary
reasons:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_death</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">score</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">0.15</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">age</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">sex</span></span>
<span>  <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can add those nodes to the <code>DAG</code> as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"advance_age"</span>, parents<span class="op">=</span><span class="st">"age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"death"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_death</span>, event_duration<span class="op">=</span><span class="cn">Inf</span>, save_past_events<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>          check_inputs<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We simply pass the <code>node_advance_age()</code> function to the
<code>type</code> argument of the <code>age</code> node.
<code>death</code> is a <em>time-to-event</em> node, because it’s an
event which is generated from a probability at each step in time. That
probability, as defined here, is determined by the
<code>prob_death</code> function we defined earlier. We set
<code>event_duration</code> to <code>Inf</code> to make this a permanent
event (once you are dead, there is no going back).</p>
<p>To visualize the resulting DAG, we can use the associated
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dag</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: ggforce</span></span></code></pre></div>
<p><img src="v_sim_discrete_time_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>To finally generate the desired data, we simply call the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">43</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span>n_sim<span class="op">=</span><span class="fl">10</span>, dag<span class="op">=</span><span class="va">dag</span>, max_t<span class="op">=</span><span class="fl">50</span>, check_inputs<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>By setting <code>max_t=50</code>, we are letting this simulation run
for 50 (simulated) years. The results look like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age    sex death_event death_time   .id</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;lgcl&gt;      &lt;lgcl&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: 79.81243   TRUE        TRUE         27     1</span></span>
<span><span class="co">#&gt; 2: 72.12698   TRUE        TRUE         13     2</span></span>
<span><span class="co">#&gt; 3: 77.57016  FALSE        TRUE         31     3</span></span>
<span><span class="co">#&gt; 4: 82.32593  FALSE        TRUE         16     4</span></span>
<span><span class="co">#&gt; 5: 75.47951  FALSE        TRUE         17     5</span></span>
<span><span class="co">#&gt; 6: 78.61284  FALSE        TRUE          9     6</span></span></code></pre></div>
<p>It is easy to see that all people died over the course of those 50
years by looking at the <code>death_event</code> column. The
<code>death_time</code> column records the time at which each person
died.</p>
<p>If we want to graphically display a flow diagram of the
data-generation mechanism, we may use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method
associated with the output of the <code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code>
function like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="v_sim_discrete_time_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>This particular example could be simulated in a much easier fashion,
without relying on a discrete-time approach, because <code>age</code>
increases linearly and the model for <code>death</code> is exactly the
same regardless of time. DTS is more useful when truly complex data
structures are required. Below we will extend this simple example a
little bit, but we will still keep it relatively simple.</p>
</div>
<div class="section level2">
<h2 id="extending-the-simple-example---recurrent-events">Extending the Simple Example - Recurrent Events<a class="anchor" aria-label="anchor" href="#extending-the-simple-example---recurrent-events"></a>
</h2>
<p>Suppose that the event of interest wasn’t <code>death</code>, but a
cardiovascular event (<code>cve</code>). For the case of simplicity we
will assume that the same causal structure and causal coefficients from
above still apply, but that the event is now no longer terminal and may
re-occur an arbitrary number of times. First, let’s redefine the nodes
to get the new name right:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">30</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>We also redefine the function that generates the required event
probabilities:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_cve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">score</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">15</span> <span class="op">+</span> <span class="fl">0.15</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">age</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">sex</span></span>
<span>  <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, all we have to do in this case is change some arguments of the
<code><a href="../reference/node_time_to_event.html">node_time_to_event()</a></code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="va">dag</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"advance_age"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/node.html">node_td</a></span><span class="op">(</span><span class="st">"cve"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>          prob_fun<span class="op">=</span><span class="va">prob_cve</span>, event_duration<span class="op">=</span><span class="fl">1</span>, save_past_events<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Apart from changing the node name, we also changed the
<code>event_duration</code> parameter to 1, meaning that a
cardiovascular event only lasts 1 year. We also set
<code>save_past_events</code> to <code>TRUE</code> in order to store the
possible recurrent events. Now we call the
<code><a href="../reference/sim_discrete_time.html">sim_discrete_time()</a></code> function as before:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span>n_sim<span class="op">=</span><span class="fl">10</span>, dag<span class="op">=</span><span class="va">dag</span>, max_t<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         age    sex cve_event cve_time   .id</span></span>
<span><span class="co">#&gt;       &lt;num&gt; &lt;lgcl&gt;    &lt;lgcl&gt;    &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: 82.67833   TRUE     FALSE       NA     1</span></span>
<span><span class="co">#&gt; 2: 90.30020  FALSE      TRUE       50     2</span></span>
<span><span class="co">#&gt; 3: 88.25512   TRUE     FALSE       NA     3</span></span>
<span><span class="co">#&gt; 4: 90.28344  FALSE     FALSE       NA     4</span></span>
<span><span class="co">#&gt; 5: 79.90450   TRUE     FALSE       NA     5</span></span>
<span><span class="co">#&gt; 6: 81.70720   TRUE     FALSE       NA     6</span></span></code></pre></div>
<p>In this case, the data is a little more complex. At time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">t = 50</annotation></semantics></math>,
only one person is currently experiencing a cardiovascular event, which
is why the <code>cve_event</code> column is <code>FALSE</code> in almost
all rows and the <code>cve_time</code> column is <code>NA</code> in
almost all rows. We need to transform this output data into different
formats using the <code><a href="../reference/sim2data.html">sim2data()</a></code> function to gain more
information.</p>
<p>For example, we can transform it into the start-stop format:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_start_stop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim_dat</span>, to<span class="op">=</span><span class="st">"start_stop"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_start_stop</span><span class="op">)</span></span>
<span><span class="co">#&gt;      .id start  stop    cve      age    sex</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;lgcl&gt;    &lt;num&gt; &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1    50  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 2:     2     1    43  FALSE 90.30020  FALSE</span></span>
<span><span class="co">#&gt; 3:     2    44    44   TRUE 90.30020  FALSE</span></span>
<span><span class="co">#&gt; 4:     2    45    49  FALSE 90.30020  FALSE</span></span>
<span><span class="co">#&gt; 5:     2    50    50   TRUE 90.30020  FALSE</span></span>
<span><span class="co">#&gt; 6:     3     1    50  FALSE 88.25512   TRUE</span></span></code></pre></div>
<p>In this format, we can clearly see when the events occurred. This
type of format is usually used to fit statistical models for
time-to-event data (although before fitting those, you might want to
take a look at the <code>target_event</code>, <code>overlap</code> and
<code>keep_only_first</code> arguments of <code><a href="../reference/sim2data.html">sim2data()</a></code>).
Another possibility is to transform it into the long-format:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim2data.html">sim2data</a></span><span class="op">(</span><span class="va">sim_dat</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;.id, .time&gt;</span></span>
<span><span class="co">#&gt;      .id .time    cve      age    sex</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;lgcl&gt;    &lt;num&gt; &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 2:     1     2  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 3:     1     3  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 4:     1     4  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 5:     1     5  FALSE 82.67833   TRUE</span></span>
<span><span class="co">#&gt; 6:     1     6  FALSE 82.67833   TRUE</span></span></code></pre></div>
<p>This may also be useful to fit discrete-time survival models.</p>
<p>The simulation done here assumes that the time and number of previous
events has no effect on any further events of the patient. This
assumption may be relaxed by explicitly formulating the
<code>prob_cve</code> function in a way that it uses the
<code>cve_time</code> column to change the probability of further
events. A more in-depth example that includes considerations like these
can be found in the third vignette of this package.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Banks, Jerry, John S. Carson II, Barry L. Nelson, and David M. Nicol
(2014). Discrete-Event System Simulation. Vol. 5. Edinburgh Gate:
Pearson Education Limited.</p>
<p>Bilge, Ugur and Osman Saka (2006). “Agent Based Simulations in
Healthcare”. In: Ubiquity: Technologies for Better Health in Aging
Societies - Proceedings of MIE2006. Ed. by Arie Hassman, Reinhold Haux,
Johan van der Lei, Etienne De Clercq, and Francis H. Roger France. IOS
Press.</p>
<p>Spooner, Fiona, Jesse F. Abrams, Karyn Morrissey, Gavin Shaddick,
Michael Batty, Richard Milton, Adam Dennett, Nik Lomax, Nick Malleson,
Natalie Nelissen, Alex Coleman, Jamil Nur, Ying Jin, Rory Greig, Charlie
Shenton, and Mark Birkin (2021). “A Dynamic Microsimulation Model for
Epidemics”. In: Social Science &amp; Medicine 291.114461.</p>
<p>Tang, Jiangjun, George Leu, und Hussein A. Abbass. 2020. Simulation
and Computational Red Teaming for Problem Solving. Hoboken: IEEE
Press.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
