<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create Your Own Function to Simulate a Root Node, Child Node or Time-Dependent Node — node_custom • simDAG</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create Your Own Function to Simulate a Root Node, Child Node or Time-Dependent Node — node_custom"><meta name="description" content="This page describes in detail how to define custom functions to allow the usage of root nodes, child nodes or time-dependent nodes that are not directly implemented in this package. By doing so, users may create data with any functional dependence they can think of."><meta property="og:description" content="This page describes in detail how to define custom functions to allow the usage of root nodes, child nodes or time-dependent nodes that are not directly implemented in this package. By doing so, users may create data with any functional dependence they can think of."><meta property="og:image" content="https://robindenz1.github.io/simDAG/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v_cookbook.html">simDAG Cookbook</a></li>
    <li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create Your Own Function to Simulate a Root Node, Child Node or Time-Dependent Node</h1>

      <div class="d-none name"><code>node_custom.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page describes in detail how to define custom functions to allow the usage of root nodes, child nodes or time-dependent nodes that are not directly implemented in this package. By doing so, users may create data with any functional dependence they can think of.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The number of available types of nodes is limited, but this package allows the user to easily implement their own node types by writing a single custom function. Users may create their own root nodes, child nodes and time-dependent nodes. The requirements for each node type are listed below. Some simple examples for each node type are given further below.</p>
<p>If you think that your custom node type might be useful to others, please contact the maintainer of this package via the supplied e-mail address or github and we might add it to this package.</p>
<p><strong><em>Root Nodes</em></strong>:</p>
<p>Any function that generates some vector of size \(n\) with <code>n==nrow(data)</code>, or a <code>data.frame</code> with as many rows as the current data can be used as a child node. The only requirement is:</p>
<ul><li><p><strong>1.)</strong> The function should have an argument called <code>n</code> which controls how many samples to generate.</p></li>
</ul><p>Some examples that are already implemented in R outside of this package are <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm()</a></code>, <code><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma()</a></code> and <code><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta()</a></code>. The function may take any amount of further arguments, which will be passed through the three-dot syntax. Note that whenever the supplied function produces a <code>data.frame</code> (or similar object), the user has to ensure that the included columns are named properly.</p>
<p><strong><em>Child Nodes</em></strong>:</p>
<p>Again, almost any function may be used to generate a child node. Only four things are required for this to work properly:</p>
<ul><li><p><strong>1.)</strong> Its' name should start with <code>node_</code> (if you want to use a string to define it in <code>type</code>).</p></li>
<li><p><strong>2.)</strong> It should contain an argument called <code>data</code> (contains the already generated data).</p></li>
<li><p><strong>3.)</strong> It should contain an argument called <code>parents</code> (contains a vector of the child nodes parents).</p></li>
<li><p><strong>4.)</strong> It should return either a vector of length <code>n_sim</code> or a <code>data.frame</code> with any number of columns and <code>n_sim</code> rows.</p></li>
</ul><p>The function may include any amount of additional arguments specified by the user.</p>
<p><strong><em>Time-Dependent Nodes</em></strong>:</p>
<p>By time-dependent nodes we mean nodes that are created using the <code><a href="node.html">node_td</a></code> function. In general, this works in essentially the same way as for simple root nodes or child nodes. The requirements are:</p>
<ul><li><p><strong>1.)</strong> Its' name should start with <code>node_</code> (if you want to use a string to define it in <code>type</code>).</p></li>
<li><p><strong>2.)</strong> It should contain an argument called <code>data</code> (contains the already generated data).</p></li>
<li><p><strong>3.)</strong> If it is a child node, it should contain an argument called <code>parents</code> (contains a vector of the child nodes parents). This is not necessary for nodes that are independently generated.</p></li>
<li><p><strong>4.)</strong> It should return either a vector of length <code>n_sim</code> or a <code>data.frame</code> with any number of columns and <code>n_sim</code> rows.</p></li>
</ul><p>Again, any number of additional arguments is allowed and will be passed through the three-dot syntax. Additionally, users may add an argument to this function called <code>sim_time</code>. If included in the function definition, the current time of the simulation will be passed to the function on every call made to it. Similarly, the argument <code>past_states</code> may be added. If done so, a list containing all previous states of the simulation (as saved using the <code>save_states</code> argument of the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code>) function) will be passed to it internally, giving the user access to the data generated at previous points in time.</p>
<p>Users may also use the enhanced <code>formula</code> interface directly with custom child nodes and custom time-dependent nodes. This is described in detail in the vignette on specifying formulas (see <code><a href="../articles/v_using_formulas.html">vignette(topic="v_using_formulas", package="simDAG")</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Should return either a vector of length <code>nrow(data)</code> or a <code>data.table</code> or <code>data.frame</code> with <code>nrow(data)</code> rows.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3545</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">################ Custom Root Nodes ###################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using external functions without defining them yourself can be done this way</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="st">"rgamma"</span>, shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"B"</span>, type<span class="op">=</span><span class="st">"rbeta"</span>, shape1<span class="op">=</span><span class="fl">2</span>, shape2<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## define your own root node instead</span></span></span>
<span class="r-in"><span><span class="co"># this function takes the sum of a normally distributed random number and an</span></span></span>
<span class="r-in"><span><span class="co"># uniformly distributed random number</span></span></span>
<span class="r-in"><span><span class="va">custom_root</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">min</span><span class="op">=</span><span class="fl">0</span>, <span class="va">max</span><span class="op">=</span><span class="fl">1</span>, <span class="va">mean</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min<span class="op">=</span><span class="va">min</span>, max<span class="op">=</span><span class="va">max</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">mean</span>, sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="st">"custom_root"</span>, min<span class="op">=</span><span class="fl">0</span>, max<span class="op">=</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in check_inputs_root_node(name = name, type = type):</span> The 'type' parameter of a root node must be a single character string naming a defined function.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># equivalently, the function can be supplied directly</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="va">custom_root</span>, min<span class="op">=</span><span class="fl">0</span>, max<span class="op">=</span><span class="fl">10</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">############### Custom Child Nodes ###################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create a custom node function, which is just a gaussian node that</span></span></span>
<span class="r-in"><span><span class="co"># includes (bad) truncation</span></span></span>
<span class="r-in"><span><span class="va">node_gaussian_trunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span>, <span class="va">betas</span>, <span class="va">intercept</span>, <span class="va">error</span>,</span></span>
<span class="r-in"><span>                                <span class="va">left</span>, <span class="va">right</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="node_gaussian.html">node_gaussian</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, parents<span class="op">=</span><span class="va">parents</span>, betas<span class="op">=</span><span class="va">betas</span>,</span></span>
<span class="r-in"><span>                       intercept<span class="op">=</span><span class="va">intercept</span>, error<span class="op">=</span><span class="va">error</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&lt;=</span> <span class="va">left</span>, <span class="va">left</span>,</span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&gt;=</span> <span class="va">right</span>, <span class="va">right</span>, <span class="va">out</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># another custom node function, which simply returns a sum of the parents</span></span></span>
<span class="r-in"><span><span class="va">parents_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span>, <span class="va">betas</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">parents</span>, with<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># an example of using these new node types in a simulation</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"age"</span>, type<span class="op">=</span><span class="st">"rnorm"</span>, mean<span class="op">=</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"custom_1"</span>, type<span class="op">=</span><span class="st">"gaussian_trunc"</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       betas<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.4</span><span class="op">)</span>, intercept<span class="op">=</span><span class="op">-</span><span class="fl">2</span>, error<span class="op">=</span><span class="fl">2</span>, left<span class="op">=</span><span class="fl">10</span>, right<span class="op">=</span><span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"custom_2"</span>, type<span class="op">=</span><span class="va">parents_sum</span>, parents<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"custom_1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in check_inputs_child_node(name = name, type = type, parents = parents,     args = args, formula = formula, time_varying = FALSE):</span> The 'type' parameter of a child node must be a single character string pointing to a function starting with 'node_'.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_from_DAG.html">sim_from_dag</a></span><span class="op">(</span>dag<span class="op">=</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">########## Custom Time-Dependent Nodes ###############</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## example for a custom time-dependent node with no parents</span></span></span>
<span class="r-in"><span><span class="co"># this node simply draws a new value from a normal distribution at</span></span></span>
<span class="r-in"><span><span class="co"># each point in time</span></span></span>
<span class="r-in"><span><span class="va">node_custom_root_td</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">n</span>, <span class="va">mean</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">mean</span>, sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Something"</span>, type<span class="op">=</span><span class="va">node_custom_root_td</span>, n<span class="op">=</span><span class="va">n_sim</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="va">n_sim</span>, max_t<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## example for a custom time-dependent child node</span></span></span>
<span class="r-in"><span><span class="co"># draw from a normal distribution with different specifications based on</span></span></span>
<span class="r-in"><span><span class="co"># whether a previously updated time-dependent node is currently TRUE</span></span></span>
<span class="r-in"><span><span class="va">node_custom_child</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">out</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">)</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">out</span><span class="op">[</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">other_event</span><span class="op">)</span>, mean<span class="op">=</span><span class="fl">5</span>, sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"other"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, prob_fun<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"whatever"</span>, type<span class="op">=</span><span class="st">"custom_child"</span>, parents<span class="op">=</span><span class="st">"other_event"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in get(paste0("node_", type)):</span> object 'node_custom_child' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">50</span>, max_t<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> An error occured when trying to add the output of node 'Something' at time t = 1 to the current data. The message was:</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> Error in `[&lt;-.data.table`(`*tmp*`, , name, value = c(6.19202228675257, : Supplied 100 items to be assigned to 50 items of column 'Something'. If you wish to 'recycle' the RHS please use rep() to make this intent clear to readers of your code.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## using the sim_time argument in a custom node function</span></span></span>
<span class="r-in"><span><span class="co"># this function returns a continuous variable that is simply the</span></span></span>
<span class="r-in"><span><span class="co"># current simulation time squared</span></span></span>
<span class="r-in"><span><span class="va">node_square_sim_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">sim_time</span>, <span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sim_time</span><span class="op">^</span><span class="fl">2</span>, n<span class="op">=</span><span class="va">n_sim</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note that we should not actually define the sim_time argument in the</span></span></span>
<span class="r-in"><span><span class="co"># node_td() call below, because it will be passed internally, just like data</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"unclear"</span>, type<span class="op">=</span><span class="va">node_square_sim_time</span>, n_sim<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span>, max_t<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## a node using previous states of the simulation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this function simply returns the value used two simulation time steps ago +</span></span></span>
<span class="r-in"><span><span class="co"># a normally distributed random value</span></span></span>
<span class="r-in"><span><span class="va">node_prev_state</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">past_states</span>, <span class="va">sim_time</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sim_time</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">past_states</span><span class="op">[[</span><span class="va">sim_time</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">A</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note that we again do not specify the sim_time and past_states argument</span></span></span>
<span class="r-in"><span><span class="co"># directly here, because they are set internally</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"A"</span>, type<span class="op">=</span><span class="va">node_prev_state</span>, parents<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save_states="all" is needed, because we use them internally</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span>, max_t<span class="op">=</span><span class="fl">10</span>, save_states<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

