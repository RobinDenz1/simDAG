<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate a Time-to-Event Node with Multiple Mutually Exclusive Events in Discrete-Time Simulation — node_competing_events • simDAG</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate a Time-to-Event Node with Multiple Mutually Exclusive Events in Discrete-Time Simulation — node_competing_events"><meta name="description" content="This node essentially models a categorical time-dependent variable for which the time and the type of the event will be important for later usage. It adds two columns to data: name_event (which type of event the person is currently experiencing) and name_time (the time at which the current event started). Can only be used inside of the sim_discrete_time function, not outside of it. Past events and their kind are stored in two lists. See details."><meta property="og:description" content="This node essentially models a categorical time-dependent variable for which the time and the type of the event will be important for later usage. It adds two columns to data: name_event (which type of event the person is currently experiencing) and name_time (the time at which the current event started). Can only be used inside of the sim_discrete_time function, not outside of it. Past events and their kind are stored in two lists. See details."><meta property="og:image" content="https://robindenz1.github.io/simDAG/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulate a Time-to-Event Node with Multiple Mutually Exclusive Events in Discrete-Time Simulation</h1>

      <div class="d-none name"><code>node_competing_events.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This node essentially models a categorical time-dependent variable for which the time and the type of the event will be important for later usage. It adds two columns to <code>data</code>: <code>name_event</code> (which type of event the person is currently experiencing) and <code>name_time</code> (the time at which the current event started). Can only be used inside of the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function, not outside of it. Past events and their kind are stored in two lists. See details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">node_competing_events</span><span class="op">(</span><span class="va">data</span>, <span class="va">parents</span>, <span class="va">sim_time</span>, <span class="va">name</span>,</span>
<span>                      <span class="va">prob_fun</span>, <span class="va">...</span>, event_duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                      immunity_duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">event_duration</span><span class="op">)</span>,</span>
<span>                      save_past_events<span class="op">=</span><span class="cn">TRUE</span>, check_inputs<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                      <span class="va">envir</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.table</code> containing all columns specified by <code>parents</code>. Similar objects such as <code>data.frame</code>s are not supported.</p></dd>

  <dt id="arg-parents">parents<a class="anchor" aria-label="anchor" href="#arg-parents"></a></dt>
<dd><p>A character vector specifying the names of the parents that this particular child node has.</p></dd>

  <dt id="arg-sim-time">sim_time<a class="anchor" aria-label="anchor" href="#arg-sim-time"></a></dt>
<dd><p>The current time of the simulation.</p></dd>

  <dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the node. This will be used as prefix before the <code>_event</code>, <code>_time</code>, <code>_past_event_times</code> and <code>_past_event_kind</code> columns.</p></dd>

  <dt id="arg-prob-fun">prob_fun<a class="anchor" aria-label="anchor" href="#arg-prob-fun"></a></dt>
<dd><p>A function that returns a numeric matrix with <code>nrow(data)</code> rows and one column storing probabilities of occurrence for each possible event type plus a column for no events. For example, if there are two possible events such as recurrence and death, the matrix would need to contain three columns. The first storing the probability of no-event and the other two columns storing probabilities for recurrence and death per person. Since the numbers are probabilities, the matrix should only contain numbers between 0 and 1 that sum to 1 in each row. These numbers specify the person-specific probability of experiencing the events modeled by this node at the particular point in time of the simulation. The corresponding event will be generated internally using the <code><a href="rcategorical.html">rcategorical</a></code> function.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>An arbitrary number of additional named arguments passed to <code>prob_fun</code>. Ignore this if you do not want to pass any arguments.</p></dd>

  <dt id="arg-event-duration">event_duration<a class="anchor" aria-label="anchor" href="#arg-event-duration"></a></dt>
<dd><p>A numeric vector containing one positive integer for each type of event of interest, specifying how long that event should last. For example, if we are interested in modelling the time to a cardiovascular event with death as competing event, this argument would need 2 entries. One would specify the duration of the cardiovascular event and the other would be <code>Inf</code> (because death is a terminal event).</p></dd>

  <dt id="arg-immunity-duration">immunity_duration<a class="anchor" aria-label="anchor" href="#arg-immunity-duration"></a></dt>
<dd><p>A single number &gt;= <code>max(event_duration)</code> specifying how long the person should be immune to all events after experiencing one. The count internally starts when the event starts, so in order to use an immunity duration of 10 time units after the event is over <code>max(event_duration) + 10</code> should be used.</p></dd>

  <dt id="arg-save-past-events">save_past_events<a class="anchor" aria-label="anchor" href="#arg-save-past-events"></a></dt>
<dd><p>When the event modeled using this node is recurrent (<code>immunity_duration &lt; Inf &amp; any(event_duration &lt; Inf)</code>), the same person may experience multiple events over the course of the simulation. Those are generally stored in the <code>ce_past_events</code> list and <code>ce_past_causes</code> list which are included in the output of the <code>sim_discrete_time</code> function. This extends the runtime and increases RAM usage, so if you are not interested in the timing of previous events or if you are using <code>save_states="all"</code> this functionality can be turned off by setting this argument to <code>FALSE</code></p></dd>

  <dt id="arg-check-inputs">check_inputs<a class="anchor" aria-label="anchor" href="#arg-check-inputs"></a></dt>
<dd><p>Whether to perform plausibility checks for the user input or not. Is set to <code>TRUE</code> by default, but can be set to <code>FALSE</code> in order to speed things up when using this function in a simulation study or something similar.</p></dd>

  <dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>Only used internally to efficiently store the past event times. Cannot be used by the user.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When performing discrete-time simulation using the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function, the standard node functions implemented in this package are usually not sufficient because they don't capture the time-dependent nature of some very interesting variables. Often, the variable that should be modelled has some probability of occurring at each point in time. Once it does occur, it has some kind of influence on other variables for a period of time until it goes back to normal (or doesn't). This could be a car crash, a surgery, a vaccination etc. The <code><a href="node_time_to_event.html">node_time_to_event</a></code> node function can be used to model these kinds of nodes in a fairly straightforward fashion.</p>
<p>This function is an extended version of the <code><a href="node_time_to_event.html">node_time_to_event</a></code> function. Instead of simulating a binary event, it can generate multiple competing events, where the occurrence of one event at time \(t\) is mutually exclusive with the occurrence of an other event at that time. In other words, multiple events are possible, but only one can occur at a time.</p>
<p><strong><em>How it Works</em></strong>:</p>
<p>At \(t = 1\), this node will be initialized for the first time. It adds two columns to the data: <code>name_event</code> (whether the person currently has an event) and <code>name_time</code> (the time at which the current event started) where <code>name</code> is the name of the node. Additionally, it adds a list with <code>max_t</code> entries to the <code>ce_past_events</code> list returned by the <code>sim_discrete_time</code> function, which records which individuals experienced a new event at each point in time. The <code>ce_past_causes</code> list additionally records which kind of event happened at that time.</p>
<p>In a nutshell, it simply models the occurrence of some event by calculating the probability of occurrence at \(t\) and drawing a single multinomial trial from this probability. If the trial is a "success", the corresponding event column will be set to the drawn event type (described using integers, where 0 is no event and all other events are numbered consecutively), the time column will be set to the current simulation time \(t\) and the columns storing the past event times and types will receive an entry.</p>
<p>The event column will stay at its new integer value until the event is over. The duration for that is controlled by the <code>event_duration</code> parameter. When modeling terminal events such as death, one can simply set this parameter to <code>Inf</code>, making the event eternal. In many cases it will also be necessary to implement some kind of immunity after the event, which can be done using the <code>immunity_duration</code> argument. This effectively sets the probability of another occurrence of the event to 0 in the next <code>immunity_duration</code> time steps. During the immunity duration, the event may be <code>&gt; 0</code> (if the event is still ongoing) or <code>0</code> (if the <code>event_duration</code> for that event type has already passed).</p>
<p>The probability of occurrence is calculated using the function provided by the user using the <code>prob_fun</code> argument. This can be an arbitrary complex function. The only requirement is that it takes <code>data</code> as a first argument. The columns defined by the <code>parents</code> argument will be passed to this argument automatically. If it has an argument called <code>sim_time</code>, the current time of the simulation will automatically be passed to it as well. Any further arguments can be passed using the <code>prob_fun_args</code> argument. A simple example could be a multinomial logistic regression node, in which the probabilities are calculated as an additive linear combination of the columns defined by <code>parents</code>. A more complex function could include simulation-time dependent effects, further effects dependent on past event times etc. Examples can be found below and in the vignettes.</p>
<p><strong><em>What can be done with it</em></strong>:</p>
<p>This type of node naturally support the implementation of competing events, where some may be terminal or recurrent in nature and may be influenced by pretty much anything. By specifying the <code>parents</code> and <code>prob_fun</code> arguments correctly, it is possible to create an event type that is dependent on past events of itself or other time-to-event variables and other variables in general. The user can include any amount of these nodes in their simulation. It may also be used to simulate any kind of binary time-dependent variable that one would usually not associate with the name "event" as well. It is very flexible, but it does require the user to do some coding by themselves.</p>
<p><strong><em>What can't be done with it</em></strong>:</p>
<p>This function may only be used to generate competing events, meaning that the occurrence of event 1 at \(t = 1\) makes it impossible for event 2 at \(t = 1\) to occur. If the user wants to generate multiple events that are not mutually exclusive, he or she may add multiple <code><a href="node_time_to_event.html">node_time_to_event</a></code> based nodes to the <code>dag</code> argument of the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function.</p>
<p>In fact, a competing events node may be simulated using multiple calls to the <code><a href="node_time_to_event.html">node_time_to_event</a></code> based nodes as well, by defining the <code>prob_fun</code> argument of these nodes in such a way that the occurrence of event A makes the occurrence of event B impossible. This might actually be easier to implement in some situations, because it doesn't require the user to manually define a probability function that outputs a matrix of subject-specific probabilities.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a <code>data.table</code> containing the updated columns of the node.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function cannot be called outside of the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function. It only makes sense to use it as a type in a <code><a href="node.html">node_td</a></code> function call, as described in the documentation and vignettes.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="empty_dag.html">empty_dag</a></code>, <code><a href="node.html">node</a></code>, <code><a href="node.html">node_td</a></code>, <code><a href="sim_from_DAG.html">sim_from_dag</a></code>, <code><a href="sim_discrete_time.html">sim_discrete_time</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## a competing_events node with only terminal events, all with a constant</span></span></span>
<span class="r-in"><span><span class="co">## probability of occurrence, independent of any other variable</span></span></span>
<span class="r-in"><span><span class="va">prob_death_illness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># simply repeat the same probabilities for everyone</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">p_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.005</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.005</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  byrow <span class="op">=</span> <span class="cn">FALSE</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">p_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"death_illness"</span>, type<span class="op">=</span><span class="st">"competing_events"</span>, prob_fun<span class="op">=</span><span class="va">prob_death_illness</span>,</span></span>
<span class="r-in"><span>          event_duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## making one of the event-types terminal and the other recurrent</span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"death_illness"</span>, type<span class="op">=</span><span class="st">"competing_events"</span>, prob_fun<span class="op">=</span><span class="va">prob_death_illness</span>,</span></span>
<span class="r-in"><span>          event_duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## call the sim_discrete_time function to generate data from it</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">100</span>, max_t<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## more examples on how to use the sim_discrete_time function can be found</span></span></span>
<span class="r-in"><span><span class="co">## in the documentation page of the node_time_to_event function and</span></span></span>
<span class="r-in"><span><span class="co">## in the package vignettes</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

