<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Transform sim_discrete_time output into the start-stop, long- or wide-format — sim2data • simDAG</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transform sim_discrete_time output into the start-stop, long- or wide-format — sim2data"><meta name="description" content="This function transforms the output of the sim_discrete_time function into a single data.table structured in the start-stop format (also known as counting process format), the long format (one row per person per point in time) or the wide format (one row per person, one column per point in time for time-varying variables). See details."><meta property="og:description" content="This function transforms the output of the sim_discrete_time function into a single data.table structured in the start-stop format (also known as counting process format), the long format (one row per person per point in time) or the wide format (one row per person, one column per point in time for time-varying variables). See details."><meta property="og:image" content="https://robindenz1.github.io/simDAG/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simDAG</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v_cookbook.html">simDAG Cookbook</a></li>
    <li><a class="dropdown-item" href="../articles/v_covid_example.html">Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_discrete_time.html">Simulating Data using a Discrete-Time Approach</a></li>
    <li><a class="dropdown-item" href="../articles/v_sim_from_dag.html">Simulating Data from a known DAG</a></li>
    <li><a class="dropdown-item" href="../articles/v_using_formulas.html">Specifying Formulas in a DAG</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/siMDAG/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Transform <code>sim_discrete_time</code> output into the start-stop, long- or wide-format</h1>

      <div class="d-none name"><code>sim2data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function transforms the output of the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function into a single <code>data.table</code> structured in the start-stop format (also known as counting process format), the long format (one row per person per point in time) or the wide format (one row per person, one column per point in time for time-varying variables). See details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim2data</span><span class="op">(</span><span class="va">sim</span>, <span class="va">to</span>, use_saved_states<span class="op">=</span><span class="va">sim</span><span class="op">$</span><span class="va">save_states</span><span class="op">==</span><span class="st">"all"</span>,</span>
<span>         overlap<span class="op">=</span><span class="cn">FALSE</span>, target_event<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>         keep_only_first<span class="op">=</span><span class="cn">FALSE</span>, remove_not_at_risk<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>         remove_vars<span class="op">=</span><span class="cn">NULL</span>, as_data_frame<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>         check_inputs<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'simDT'</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">x</span>, keep.rownames<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">to</span>, overlap<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              target_event<span class="op">=</span><span class="cn">NULL</span>, keep_only_first<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              remove_not_at_risk<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              remove_vars<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              use_saved_states<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">save_states</span><span class="op">==</span><span class="st">"all"</span>,</span>
<span>              check_inputs<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'simDT'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span>, row.names<span class="op">=</span><span class="cn">NULL</span>, optional<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">to</span>,</span>
<span>              overlap<span class="op">=</span><span class="cn">FALSE</span>, target_event<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              keep_only_first<span class="op">=</span><span class="cn">FALSE</span>, remove_not_at_risk<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              remove_vars<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              use_saved_states<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">save_states</span><span class="op">==</span><span class="st">"all"</span>,</span>
<span>              check_inputs<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-sim-x">sim, x<a class="anchor" aria-label="anchor" href="#arg-sim-x"></a></dt>
<dd><p>An object created with the <code><a href="sim_discrete_time.html">sim_discrete_time</a></code> function.</p></dd>

  <dt id="arg-to">to<a class="anchor" aria-label="anchor" href="#arg-to"></a></dt>
<dd><p>Specifies the format of the output data. Must be one of: <code>"start_stop"</code>, <code>"long"</code>, <code>"wide"</code>.</p></dd>

  <dt id="arg-use-saved-states">use_saved_states<a class="anchor" aria-label="anchor" href="#arg-use-saved-states"></a></dt>
<dd><p>Whether the saved simulation states (argument <code>save_states</code> in <code>sim_discrete_time</code> function) should be used to construct the resulting data or not. See details.</p></dd>

  <dt id="arg-overlap">overlap<a class="anchor" aria-label="anchor" href="#arg-overlap"></a></dt>
<dd><p>Only used when <code>to="start_stop"</code>. Specifies whether the intervals should overlap or not. If <code>TRUE</code>, the <code>"stop"</code> column is simply increased by one, as compared to the output when <code>overlap=FALSE</code>. This means that changes for a given \(t\) are recorded at the start of the next interval, but the previous interval ends on that same day.</p></dd>

  <dt id="arg-target-event">target_event<a class="anchor" aria-label="anchor" href="#arg-target-event"></a></dt>
<dd><p>Only used when <code>to="start_stop"</code>. By default (keeping this argument at <code>NULL</code>) all time-to-event nodes are treated equally when creating the start-stop intervals. This can be changed by supplying a single character string to this argument, naming one time-to-event node. This node will then be treated as the outcome. The output then corresponds to what would be needed to fit a Cox proportional hazards model. See details.</p></dd>

  <dt id="arg-keep-only-first">keep_only_first<a class="anchor" aria-label="anchor" href="#arg-keep-only-first"></a></dt>
<dd><p>Only used when <code>to="start_stop"</code> and <code>target_event</code> is not <code>NULL</code>. Either <code>TRUE</code> or <code>FALSE</code> (default). If <code>TRUE</code>, all information after the first event per person will be discarded. Useful when <code>target_event</code> should be treated as a terminal variable.</p></dd>

  <dt id="arg-remove-not-at-risk">remove_not_at_risk<a class="anchor" aria-label="anchor" href="#arg-remove-not-at-risk"></a></dt>
<dd><p>Only used when <code>to="start_stop"</code> and <code>target_event</code> is not <code>NULL</code>. Either <code>TRUE</code> or <code>FALSE</code> (default). If <code>TRUE</code>, the <code>event_duration</code> and <code>immunity_duration</code> of the <code>target_event</code> are taken into account when constructing the start-stop data. More precisely, the time in which individuals are not at-risk because they are either still currently experiencing the event or because they are immune to the event is removed from the start-stop data. This may be necessary when fitting some survival regression models, because these time-periods should not be counted as time at-risk.</p></dd>

  <dt id="arg-remove-vars">remove_vars<a class="anchor" aria-label="anchor" href="#arg-remove-vars"></a></dt>
<dd><p>An optional character vector specifying which variables should <em>not</em> be included in the ouput. Set to <code>NULL</code> to include all variables included in the <code>sim</code> object (default).</p></dd>

  <dt id="arg-as-data-frame">as_data_frame<a class="anchor" aria-label="anchor" href="#arg-as-data-frame"></a></dt>
<dd><p>Set this argument to <code>TRUE</code> to return a <code>data.frame</code> instead of a <code>data.table</code>.</p></dd>

  <dt id="arg-check-inputs">check_inputs<a class="anchor" aria-label="anchor" href="#arg-check-inputs"></a></dt>
<dd><p>Whether to perform input checks (<code>TRUE</code> by default). Prints warning messages if the output may be incorrect due to missing information.</p></dd>

  <dt id="arg-keep-rownames">keep.rownames<a class="anchor" aria-label="anchor" href="#arg-keep-rownames"></a></dt>
<dd><p>Currently not used.</p></dd>

  <dt id="arg-row-names">row.names<a class="anchor" aria-label="anchor" href="#arg-row-names"></a></dt>
<dd><p>Passed to the <code>as.data.frame</code> function which is called on the finished <code>data.table</code>. See <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">?as.data.frame</a></code> for more information.</p></dd>

  <dt id="arg-optional">optional<a class="anchor" aria-label="anchor" href="#arg-optional"></a></dt>
<dd><p>Passed to the <code>as.data.frame</code> function which is called on the finished <code>data.table</code>. See <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">?as.data.frame</a></code> for more information.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code>as.data.frame</code> (conversion from finished <code>data.table</code> to <code>data.frame</code>). Only available when directly calling <code>sim2data</code> with <code>as_data_frame=TRUE</code> or when using <code>as.data.frame.simDT</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The raw output of the <code>sim_discrete_time</code> function may be difficult to use for further analysis. Using one of these functions, it is straightforward to transform that output into three different formats, which are described below. Note that some caution needs to be applied when using this function, which is also described below. Both <code>as.data.table</code> and <code>as.data.frame</code> internally call <code>sim2data</code> and only exist for user convenience.</p>
<p><strong><em>The start-stop format</em>:</strong></p>
<p>The start-stop format (<code>to="start_stop"</code>), also known as counting process or period format corresponds to a <code>data.table</code> containing multiple rows per person, where each row corresponds to a period of time in which no variables changed. These intervals are defined by the <code>start</code> and <code>stop</code> columns. The <code>start</code> column gives the time at which the period started, the <code>stop</code> column denotes the time when the period ended. By default these intervals are coded to be non-overlapping, meaning that the edges of the periods are included in the period itself. For example, if the respective period is exactly 1 point in time long, <code>start</code> will be equal to <code>stop</code>. If non-overlapping periods are desired, the user can specify <code>overlap=TRUE</code> instead.</p>
<p>By default, all time-to-event nodes are treated equally. This is not optimal when the goal is to fit survival regression models. In this case, we usually want the target event to be treated in a special way (see for example Chiou et al. 2023). In general, instead of creating new intervals for it we want existing intervals to end at event times with the corresponding event indicator. This can be achieved by naming the target outcome in the <code>target_event</code> variable. The previously specified duration of this target event is then ignored. To additionally remove all time periods in which individuals are not at-risk due to the event still going on or them being immune to it (as specified using the <code>event_duration</code> and <code>immunity_duration</code> parameters of <code><a href="node_time_to_event.html">node_time_to_event</a></code>), users may set <code>remove_not_at_risk=TRUE</code>. If only the first occurrence of the event is of interest, users may also set <code>keep_only_first=TRUE</code> to keep only information up until the first event per person.</p>
<p><strong><em>The long format</em>:</strong></p>
<p>The long format (<code>to="long"</code>) corresponds to a <code>data.table</code> in which there is one row per person per point in time. The unique person identifier is stored in the <code>.id</code> column and the unique points in time are given in the <code>.time</code> column.</p>
<p><strong><em>The wide format</em>:</strong></p>
<p>The wide format (<code>to="wide"</code>) corresponds to a <code>data.table</code> with exactly one row per person and multiple columns per points in time for each time-varying variable. All time-varying variables are coded as their original variable name with an underscore and the time-point appended to the end. For example, the variable <code>sickness</code> at time-point 3 is named <code>"sickness_3"</code>.</p>
<p><strong><em>Output with <code>use_saved_states=TRUE</code></em>:</strong></p>
<p>If <code>use_saved_states=TRUE</code>, this function will use only the data that is stored in the <code>past_states</code> list of the <code>sim</code> object to construct the resulting <code>data.table</code>. This results in the following behavior, depending on which <code>save_states</code> option was used in the original <code>sim_discrete_time</code> function call:</p>
<ul><li><p><code>save_states="all"</code>: A complete <code>data.table</code> in the desired format with information for <strong>all observations</strong> at <strong>all points in time</strong> for <strong>all variables</strong> will be created. This is the safest option, but also uses the most RAM and computational time.</p></li>
<li><p><code>save_states="at_t"</code>: A <code>data.table</code> in the desired format with correct information for <strong>all observations</strong> at the <strong>user specified times</strong> (<code>save_states_at</code> argument) for <strong>all variables</strong> will be created. The state of the simulation at all other times will be ignored, because it wasn't stored. This may be useful in some scenarios, but is generally discouraged unless you have good reasons to use it. A warning message about this is printed if <code>check_inputs=TRUE</code>.</p></li>
<li><p><code>save_states="last"</code>: Since only the last state of the simulation was saved, an error message is returned. <strong>No</strong> <code>data.table</code> is produced.</p></li>
</ul><p><strong><em>Output with <code>use_saved_states=FALSE</code></em>:</strong></p>
<p>If <code>use_saved_states=FALSE</code>, this function will use only the data that is stored in the final state of the simulation (<code>data</code> object in <code>sim</code>) and information about <code>node_time_to_event</code> objects. If all <code>tx_nodes</code> are <code>time_to_event</code> nodes or if all the user cares about are the <code>time_to_event</code> nodes and time-fixed variables, this is the best option.</p>
<p>A <code>data.table</code> in the desired format with correct information about <code>all observations</code> at <code>all times</code> is produced, but only with correct entries for <strong>some time-varying variables</strong>, namely <code>time_to_event</code> nodes. Note that this information will also only be correct if the user used <code>save_past_events=TRUE</code> in all <code>time_to_event</code> nodes. Support for <code>competing_events</code> nodes will be implemented in the future as well.</p>
<p>The other time-varying variables specified in the <code>tx_nodes</code> argument will still appear in the output, but it will only be the value that was observed at the last state of the simulation.</p>
<p><strong><em>Optional columns created using a <code>time_to_event</code> node</em>:</strong></p>
<p>When using a time-dependent node of type <code>"time_to_event"</code> with <code>event_count=TRUE</code> or <code>time_since_last=TRUE</code>, the columns created using either argument are <strong>not</strong> included in the output if <code>to="start_stop"</code>, but will be included if <code>to</code> is set to either <code>"long"</code> or <code>"wide"</code>. The reason for this behavior is that including these columns would lead to nonsense intervals in the start-stop format, but makes sense in the other formats.</p>
<p><strong><em>What about <code>tx_nodes</code> that are not <code>time_to_event</code> nodes?</em>:</strong></p>
<p>If you want the correct output for all <code>tx_nodes</code> and one or more of those are not <code>time_to_event</code> nodes, you will have to use <code>save_states="all"</code> in the original <code>sim_discrete_time</code> call. We plan to add support for <code>competing_events</code> with other <code>save_states</code> arguments in the near future. Support for arbitrary <code>tx_nodes</code> will probably take longer.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Using the node names <code>"start"</code>, <code>"stop"</code>, <code>".id"</code>, <code>".time"</code> or names that are automatically generated by time-dependent nodes of type <code>"time_to_event"</code> may break this function.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a single <code>data.table</code> (or <code>data.frame</code>) containing all simulated variables in the desired format.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sim_discrete_time.html">sim_discrete_time</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Sy Han Chiou, Gongjun Xu, Jun Yan, and Chiung-Yu Huang (2023). "Regression Modeling for Recurrent Events Possibly with an Informative Terminal Event Using R Package reReg". In: Journal of Statistical Software. 105.5, pp. 1-34.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/simDAG" class="external-link">simDAG</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">435345</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## exemplary car crash simulation, where the probability for</span></span></span>
<span class="r-in"><span><span class="co">## a car crash is dependent on the sex, and the probability of death is</span></span></span>
<span class="r-in"><span><span class="co">## highly increased for 3 days after a car crash happened</span></span></span>
<span class="r-in"><span><span class="va">prob_car_crash</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sex</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prob_death</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">car_crash_event</span>, <span class="fl">0.1</span>, <span class="fl">0.001</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="empty_dag.html">empty_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node</a></span><span class="op">(</span><span class="st">"sex"</span>, type<span class="op">=</span><span class="st">"rbernoulli"</span>, p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"car_crash"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, prob_fun<span class="op">=</span><span class="va">prob_car_crash</span>,</span></span>
<span class="r-in"><span>          parents<span class="op">=</span><span class="st">"sex"</span>, event_duration<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="node.html">node_td</a></span><span class="op">(</span><span class="st">"death"</span>, type<span class="op">=</span><span class="st">"time_to_event"</span>, prob_fun<span class="op">=</span><span class="va">prob_death</span>,</span></span>
<span class="r-in"><span>          parents<span class="op">=</span><span class="st">"car_crash_event"</span>, event_duration<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate some data, only saving the last state</span></span></span>
<span class="r-in"><span><span class="co"># not a problem here, because the only time-varying nodes are</span></span></span>
<span class="r-in"><span><span class="co"># time-to-event nodes where the event times are saved</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_discrete_time.html">sim_discrete_time</a></span><span class="op">(</span><span class="va">dag</span>, n_sim<span class="op">=</span><span class="fl">20</span>, max_t<span class="op">=</span><span class="fl">500</span>, save_states<span class="op">=</span><span class="st">"last"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># transform to standard start-stop format</span></span></span>
<span class="r-in"><span><span class="va">d_start_stop</span> <span class="op">&lt;-</span> <span class="fu">sim2data</span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"start_stop"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_start_stop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      .id start  stop car_crash  death    sex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;int&gt; &lt;int&gt; &lt;num&gt;    &lt;lgcl&gt; &lt;lgcl&gt; &lt;lgcl&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     1     1   114     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     1   115   117      TRUE   TRUE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     1   118   417     FALSE   TRUE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     1   418   420      TRUE   TRUE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     1   421   481     FALSE   TRUE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     1   482   484      TRUE   TRUE  FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># transform to "death" centric start-stop format</span></span></span>
<span class="r-in"><span><span class="co"># and keep only information until death, cause it's a terminal event</span></span></span>
<span class="r-in"><span><span class="co"># (this could be used in a Cox model)</span></span></span>
<span class="r-in"><span><span class="va">d_start_stop</span> <span class="op">&lt;-</span> <span class="fu">sim2data</span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"start_stop"</span>, target_event<span class="op">=</span><span class="st">"death"</span>,</span></span>
<span class="r-in"><span>                         keep_only_first<span class="op">=</span><span class="cn">TRUE</span>, overlap<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_start_stop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      .id start  stop car_crash  death    sex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;int&gt; &lt;int&gt; &lt;num&gt;    &lt;lgcl&gt; &lt;lgcl&gt; &lt;lgcl&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     1     1   115     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     1   115   116      TRUE   TRUE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     2     1    42     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     2    42    45      TRUE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     2    45   232     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     2   232   235      TRUE  FALSE  FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># transform to long-format</span></span></span>
<span class="r-in"><span><span class="va">d_long</span> <span class="op">&lt;-</span> <span class="fu">sim2data</span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"long"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_long</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;.id, .time&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      .id .time car_crash  death    sex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;int&gt; &lt;int&gt;    &lt;lgcl&gt; &lt;lgcl&gt; &lt;lgcl&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     1     1     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     1     2     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     1     3     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     1     4     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     1     5     FALSE  FALSE  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     1     6     FALSE  FALSE  FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># transform to wide-format</span></span></span>
<span class="r-in"><span><span class="va">d_wide</span> <span class="op">&lt;-</span> <span class="fu">sim2data</span><span class="op">(</span><span class="va">sim</span>, to<span class="op">=</span><span class="st">"wide"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#head(d_wide)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz, Katharina Meiszl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

